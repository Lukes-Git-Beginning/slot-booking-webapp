{% extends "hub/base.html" %}

{% block title %}Analytics Dashboard{% endblock %}

{% block content %}

<!-- Header -->
<div class="glass rounded-3xl p-8 md:p-12 mb-8 relative overflow-hidden" data-aos="fade-down">
    <div class="gradient-bg absolute inset-0 opacity-20"></div>

    <div class="relative z-10">
        <div class="flex items-center gap-4 mb-4">
            <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-primary to-secondary flex items-center justify-center animate-float">
                <i data-lucide="trending-up" class="w-8 h-8 text-white"></i>
            </div>
            <div>
                <h1 class="text-3xl md:text-4xl font-bold text-white">Analytics Dashboard</h1>
                <p class="text-white/70 mt-1">Detaillierte Einblicke in deine Performance und Verhaltensmuster</p>
            </div>
        </div>

        <a href="{{ url_for('scoreboard.gamification_dashboard') }}" class="inline-flex items-center gap-2 text-primary hover:text-blue-400 transition-colors">
            <i data-lucide="arrow-left" class="w-4 h-4"></i>
            <span>Zurück zum Dashboard</span>
        </a>
    </div>
</div>

<!-- Tabs -->
<div class="glass rounded-2xl p-2 mb-8 flex gap-2 flex-wrap" data-aos="fade-up" data-aos-delay="100" x-data="{ activeTab: 'overview' }">
    <button
        @click="activeTab = 'overview'"
        :class="activeTab === 'overview' ? 'bg-primary text-white' : 'text-white/70 hover:text-white hover:bg-white/5'"
        class="flex-1 min-w-[150px] px-6 py-3 rounded-xl font-semibold transition-all duration-300 flex items-center justify-center gap-2">
        <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
        <span>Überblick</span>
    </button>
    <button
        @click="activeTab = 'patterns'"
        :class="activeTab === 'patterns' ? 'bg-primary text-white' : 'text-white/70 hover:text-white hover:bg-white/5'"
        class="flex-1 min-w-[150px] px-6 py-3 rounded-xl font-semibold transition-all duration-300 flex items-center justify-center gap-2">
        <i data-lucide="search" class="w-5 h-5"></i>
        <span>Muster</span>
    </button>
    <button
        @click="activeTab = 'predictions'"
        :class="activeTab === 'predictions' ? 'bg-primary text-white' : 'text-white/70 hover:text-white hover:bg-white/5'"
        class="flex-1 min-w-[150px] px-6 py-3 rounded-xl font-semibold transition-all duration-300 flex items-center justify-center gap-2">
        <i data-lucide="sparkles" class="w-5 h-5"></i>
        <span>Prognosen</span>
    </button>
    <button
        @click="activeTab = 'recommendations'"
        :class="activeTab === 'recommendations' ? 'bg-primary text-white' : 'text-white/70 hover:text-white hover:bg-white/5'"
        class="flex-1 min-w-[150px] px-6 py-3 rounded-xl font-semibold transition-all duration-300 flex items-center justify-center gap-2">
        <i data-lucide="lightbulb" class="w-5 h-5"></i>
        <span>Empfehlungen</span>
    </button>

    <!-- Overview Tab -->
    <div x-show="activeTab === 'overview'" x-transition class="w-full pt-6">

        <!-- Key Metrics Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">

            <!-- Activity Card -->
            <div class="glass rounded-2xl p-6 hover:scale-105 transition-transform duration-300" data-aos="fade-up" data-aos-delay="100">
                <div class="flex items-center gap-3 mb-4">
                    <i data-lucide="activity" class="w-6 h-6 text-primary"></i>
                    <h3 class="text-lg font-semibold text-primary">Aktivität</h3>
                </div>
                <div class="text-5xl font-bold text-white mb-2">{{ analytics.overview.total_days_active or 0 }}</div>
                <div class="text-white/60 mb-4">Aktive Tage</div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-white/5 rounded-lg p-3 text-center">
                        <div class="text-2xl font-bold text-primary">{{ analytics.overview.average_daily_bookings or 0 }}</div>
                        <div class="text-xs text-white/60">Ø Buchungen/Tag</div>
                    </div>
                    <div class="bg-white/5 rounded-lg p-3 text-center">
                        <div class="text-lg font-bold text-secondary">{{ analytics.overview.activity_level or "Niedrig" }}</div>
                        <div class="text-xs text-white/60">Aktivitätslevel</div>
                    </div>
                </div>
            </div>

            <!-- Streaks Card -->
            <div class="glass rounded-2xl p-6 hover:scale-105 transition-transform duration-300" data-aos="fade-up" data-aos-delay="200">
                <div class="flex items-center gap-3 mb-4">
                    <i data-lucide="flame" class="w-6 h-6 text-accent"></i>
                    <h3 class="text-lg font-semibold text-accent">Streaks</h3>
                </div>
                <div class="text-5xl font-bold text-white mb-2">{{ analytics.overview.current_streak or 0 }}</div>
                <div class="text-white/60 mb-4">Aktuelle Streak</div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-white/5 rounded-lg p-3 text-center">
                        <div class="text-2xl font-bold text-accent">{{ analytics.overview.longest_streak or 0 }}</div>
                        <div class="text-xs text-white/60">Beste Streak</div>
                    </div>
                    <div class="bg-white/5 rounded-lg p-3 text-center">
                        <div class="text-lg font-bold text-secondary">{{ analytics.overview.consistency_rating or "Gut" }}</div>
                        <div class="text-xs text-white/60">Konsistenz</div>
                    </div>
                </div>
            </div>

            <!-- Efficiency Card -->
            <div class="glass rounded-2xl p-6 hover:scale-105 transition-transform duration-300" data-aos="fade-up" data-aos-delay="300">
                <div class="flex items-center gap-3 mb-4">
                    <i data-lucide="target" class="w-6 h-6 text-secondary"></i>
                    <h3 class="text-lg font-semibold text-secondary">Effizienz</h3>
                </div>
                <div class="text-5xl font-bold text-white mb-2">{{ analytics.overview.efficiency_score or 0 }}%</div>
                <div class="text-white/60 mb-4">Effizienz-Score</div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-white/5 rounded-lg p-3 text-center">
                        <div class="text-lg font-bold text-secondary">{{ analytics.overview.peak_activity_time or "10:00" }}</div>
                        <div class="text-xs text-white/60">Peak-Zeit</div>
                    </div>
                    <div class="bg-white/5 rounded-lg p-3 text-center">
                        <div class="text-lg font-bold text-secondary">{{ analytics.overview.peak_activity_day or "Montag" }}</div>
                        <div class="text-xs text-white/60">Peak-Tag</div>
                    </div>
                </div>
            </div>

            <!-- Behavioral Insights Card -->
            <div class="glass rounded-2xl p-6 bg-gradient-to-br from-primary/20 to-secondary/20 hover:scale-105 transition-transform duration-300" data-aos="fade-up" data-aos-delay="400">
                <div class="flex items-center gap-3 mb-4">
                    <i data-lucide="brain" class="w-6 h-6 text-white"></i>
                    <h3 class="text-lg font-semibold text-white">Behavioral Insights</h3>
                </div>
                <div class="inline-block px-4 py-2 bg-white/20 backdrop-blur-sm rounded-full text-sm font-semibold border border-white/10 mb-4 text-white">
                    {{ analytics.behavioral_insights.user_type or "Balanced User" }}
                </div>

                <h4 class="font-semibold mb-2 flex items-center gap-2 text-white">
                    <i data-lucide="zap" class="w-4 h-4"></i>
                    Motivationsfaktoren:
                </h4>
                <ul class="space-y-2">
                    {% for driver in analytics.behavioral_insights.motivation_drivers or [] %}
                    <li class="flex items-center gap-2 text-sm border-b border-white/10 pb-2 text-white/90">
                        <i data-lucide="sparkles" class="w-4 h-4"></i>
                        <span>{{ driver }}</span>
                    </li>
                    {% endfor %}
                </ul>

                <div class="mt-4 pt-4 border-t border-white/20 text-white">
                    <strong class="text-sm">Engagement Pattern:</strong>
                    <span class="ml-2 text-sm">{{ analytics.behavioral_insights.engagement_pattern or "Regular" }}</span>
                </div>
            </div>
        </div>

        <!-- Performance Trends Chart -->
        <div class="glass rounded-2xl p-6 mb-8" data-aos="fade-up" data-aos-delay="500">
            <div class="flex items-center gap-3 mb-6">
                <i data-lucide="trending-up" class="w-6 h-6 text-primary"></i>
                <h3 class="text-xl font-bold text-white">Performance Trends</h3>
            </div>
            <div id="performanceChart" style="min-height: 300px;"></div>
            <div class="flex gap-4 mt-6 flex-wrap">
                <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold
                    {% if analytics.performance_trends.points_trend == 'improving' %}bg-secondary/20 text-secondary border border-secondary/40
                    {% elif analytics.performance_trends.points_trend == 'declining' %}bg-error/20 text-error border border-error/40
                    {% else %}bg-white/10 text-white/60 border border-white/20{% endif %}">
                    <i data-lucide="{% if analytics.performance_trends.points_trend == 'improving' %}trending-up{% elif analytics.performance_trends.points_trend == 'declining' %}trending-down{% else %}minus{% endif %}" class="w-4 h-4"></i>
                    <span>Punkte {{ analytics.performance_trends.points_trend or 'stable' }}</span>
                </div>
                <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold
                    {% if analytics.performance_trends.booking_trend == 'improving' %}bg-secondary/20 text-secondary border border-secondary/40
                    {% elif analytics.performance_trends.booking_trend == 'declining' %}bg-error/20 text-error border border-error/40
                    {% else %}bg-white/10 text-white/60 border border-white/20{% endif %}">
                    <i data-lucide="calendar" class="w-4 h-4"></i>
                    <span>Buchungen {{ analytics.performance_trends.booking_trend or 'stable' }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Patterns Tab -->
    <div x-show="activeTab === 'patterns'" x-transition class="w-full pt-6">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">

            <!-- Time Preferences -->
            <div class="glass rounded-2xl p-6" data-aos="fade-up" data-aos-delay="100">
                <div class="flex items-center gap-3 mb-6">
                    <i data-lucide="clock" class="w-6 h-6 text-primary"></i>
                    <h3 class="text-xl font-bold text-white">Zeitpräferenzen</h3>
                </div>

                <h4 class="text-sm font-semibold text-white/60 mb-3">Bevorzugte Uhrzeiten:</h4>
                <div class="flex gap-2 flex-wrap mb-6">
                    {% for time in analytics.booking_patterns.preferred_times or [] %}
                    <span class="px-4 py-2 bg-primary/20 border border-primary/40 text-primary rounded-full text-sm font-semibold">{{ time }}</span>
                    {% endfor %}
                </div>

                <h4 class="text-sm font-semibold text-white/60 mb-3">Bevorzugte Wochentage:</h4>
                <div class="grid grid-cols-7 gap-2">
                    {% for day in ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'] %}
                    <div class="aspect-square rounded-lg flex items-center justify-center text-sm font-semibold
                        {% if day[:2] in (analytics.booking_patterns.preferred_days or [])|map('slice', 0, 2) %}bg-primary/20 border border-primary/40 text-primary{% else %}bg-white/5 text-white/40{% endif %}">
                        {{ day }}
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Booking Behavior -->
            <div class="glass rounded-2xl p-6" data-aos="fade-up" data-aos-delay="200">
                <div class="flex items-center gap-3 mb-6">
                    <i data-lucide="gauge" class="w-6 h-6 text-accent"></i>
                    <h3 class="text-xl font-bold text-white">Buchungsverhalten</h3>
                </div>
                <div class="text-4xl font-bold text-white mb-2">{{ analytics.booking_patterns.booking_velocity or "Normal" }}</div>
                <div class="text-white/60 mb-6">Buchungsgeschwindigkeit</div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white/5 rounded-lg p-4 text-center">
                        <div class="text-3xl font-bold text-accent">{{ analytics.booking_patterns.advance_booking_days or 0 }}</div>
                        <div class="text-xs text-white/60 mt-1">Ø Vorlaufzeit (Tage)</div>
                    </div>
                    <div class="bg-white/5 rounded-lg p-4 text-center">
                        <div class="text-3xl font-bold text-secondary">{{ analytics.booking_patterns.consistency_score|round or 0 }}%</div>
                        <div class="text-xs text-white/60 mt-1">Konsistenz-Score</div>
                    </div>
                </div>
            </div>

            <!-- Seasonal Patterns Chart -->
            <div class="glass rounded-2xl p-6" data-aos="fade-up" data-aos-delay="300">
                <div class="flex items-center gap-3 mb-6">
                    <i data-lucide="calendar-days" class="w-6 h-6 text-secondary"></i>
                    <h3 class="text-xl font-bold text-white">Saisonale Muster</h3>
                </div>
                <div id="seasonalChart" style="min-height: 300px;"></div>
            </div>

            <!-- Achievement Analysis -->
            <div class="glass rounded-2xl p-6" data-aos="fade-up" data-aos-delay="400">
                <div class="flex items-center gap-3 mb-6">
                    <i data-lucide="award" class="w-6 h-6 text-secondary"></i>
                    <h3 class="text-xl font-bold text-white">Achievement-Analyse</h3>
                </div>
                <div class="text-4xl font-bold text-white mb-2">{{ analytics.achievements_analysis.completion_rate or 0 }}%</div>
                <div class="text-white/60 mb-6">Abschlussquote</div>

                <h4 class="text-sm font-semibold text-white/60 mb-3">Lieblingskategorien:</h4>
                <div class="flex gap-2 flex-wrap mb-6">
                    {% for category in analytics.achievements_analysis.favorite_categories or [] %}
                    <span class="px-3 py-1 bg-secondary/20 border border-secondary/40 text-secondary rounded-full text-xs font-semibold">{{ category|title }}</span>
                    {% endfor %}
                </div>

                <div class="space-y-3">
                    {% for rec in analytics.achievements_analysis.next_recommendations[:5] or [] %}
                    <div class="flex items-center gap-3">
                        <div class="text-xs font-medium text-white/60 min-w-[100px] truncate">{{ rec.name[:15] + '...' if rec.name|length > 15 else rec.name }}</div>
                        <div class="flex-1 h-2 bg-white/10 rounded-full overflow-hidden">
                            <div class="h-full bg-primary rounded-full transition-all duration-500" style="width: {{ rec.progress_percent }}%"></div>
                        </div>
                        <div class="text-xs text-white/60 min-w-[40px] text-right">{{ rec.progress_percent|round }}%</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Predictions Tab -->
    <div x-show="activeTab === 'predictions'" x-transition class="w-full pt-6">

        <!-- Future Predictions -->
        <div class="glass rounded-3xl p-8 bg-gradient-to-br from-secondary/20 to-primary/20 mb-8" data-aos="fade-up" data-aos-delay="100">
            <div class="flex items-center gap-3 mb-4">
                <i data-lucide="sparkles" class="w-8 h-8 text-white"></i>
                <h2 class="text-3xl font-bold text-white">Zukunftsprognosen</h2>
            </div>
            <p class="text-white/80 mb-6">Basierend auf deinen bisherigen Daten und Mustern</p>

            <div class="space-y-4">
                <div class="flex justify-between items-center py-4 border-b border-white/20">
                    <div class="font-medium text-white">Nächstes Level erreicht in:</div>
                    <div class="text-xl font-bold text-white">{{ analytics.predictions.next_level_eta or "Unbekannt" }}</div>
                </div>

                <div class="flex justify-between items-center py-4 border-b border-white/20">
                    <div class="font-medium text-white">Nächstes Badge erreichbar in:</div>
                    <div class="text-xl font-bold text-white">{{ analytics.predictions.next_badge_eta or "Unbekannt" }}</div>
                </div>

                <div class="flex justify-between items-center py-4 border-b border-white/20">
                    <div class="font-medium text-white">Monatliche Punkte-Prognose:</div>
                    <div class="text-xl font-bold text-white">{{ analytics.predictions.monthly_points_forecast or 0 }} Punkte</div>
                </div>

                <div class="flex justify-between items-center py-4 border-b border-white/20">
                    <div class="font-medium text-white">Streak-Überlebenswahrscheinlichkeit:</div>
                    <div class="text-xl font-bold text-white">{{ analytics.predictions.streak_survival_probability or 0 }}%</div>
                </div>

                <div class="flex justify-between items-center py-4">
                    <div class="font-medium text-white">Performance-Trajektorie:</div>
                    <div class="text-xl font-bold flex items-center gap-2 text-white">
                        {% if analytics.predictions.performance_trajectory == 'improving' %}
                        <i data-lucide="trending-up" class="w-5 h-5"></i> Verbessernd
                        {% elif analytics.predictions.performance_trajectory == 'declining' %}
                        <i data-lucide="trending-down" class="w-5 h-5"></i> Abnehmend
                        {% else %}
                        <i data-lucide="minus" class="w-5 h-5"></i> Stabil
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Peer Comparison -->
        <div class="glass rounded-2xl p-6" data-aos="fade-up" data-aos-delay="200">
            <div class="flex items-center gap-3 mb-6">
                <i data-lucide="users" class="w-6 h-6 text-primary"></i>
                <h3 class="text-xl font-bold text-white">Vergleich mit anderen</h3>
            </div>

            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-white/5 rounded-lg p-6 text-center">
                    <div class="text-4xl font-bold text-primary">#{{ analytics.comparisons.ranking_position or "?" }}</div>
                    <div class="text-sm text-white/60 mt-2">Deine Position</div>
                </div>
                <div class="bg-white/5 rounded-lg p-6 text-center">
                    <div class="text-4xl font-bold text-secondary">{{ analytics.comparisons.percentile or 0 }}%</div>
                    <div class="text-sm text-white/60 mt-2">Percentile</div>
                </div>
            </div>

            <h4 class="text-sm font-semibold text-white/60 mb-3">Überdurchschnittliche Bereiche:</h4>
            <ul class="space-y-2 mb-6">
                {% for area in analytics.comparisons.above_average_areas or [] %}
                <li class="flex items-center gap-2 text-secondary">
                    <i data-lucide="check" class="w-4 h-4"></i>
                    <span>{{ area }}</span>
                </li>
                {% endfor %}
            </ul>

            <h4 class="text-sm font-semibold text-white/60 mb-3">Verbesserungsmöglichkeiten:</h4>
            <ul class="space-y-2">
                {% for opp in analytics.comparisons.improvement_opportunities or [] %}
                <li class="flex items-center gap-2 text-white/70">
                    <i data-lucide="arrow-up" class="w-4 h-4"></i>
                    <span>{{ opp }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- Recommendations Tab -->
    <div x-show="activeTab === 'recommendations'" x-transition class="w-full pt-6">
        <div class="glass rounded-3xl p-8" data-aos="fade-up" data-aos-delay="100">
            <div class="flex items-center gap-3 mb-4">
                <i data-lucide="lightbulb" class="w-8 h-8 text-accent"></i>
                <h2 class="text-3xl font-bold text-white">Personalisierte Empfehlungen</h2>
            </div>
            <p class="text-white/60 mb-8">Maßgeschneiderte Tipps um deine Performance zu verbessern</p>

            <!-- Immediate Actions -->
            <div class="mb-8">
                <div class="flex items-center gap-2 mb-4">
                    <i data-lucide="zap" class="w-5 h-5 text-accent"></i>
                    <h4 class="text-lg font-semibold text-white">Sofortige Maßnahmen</h4>
                </div>
                <ul class="space-y-3">
                    {% for action in analytics.recommendations.immediate_actions or [] %}
                    <li class="p-4 rounded-lg border-l-4
                        {% if action.priority == 'high' %}bg-error/10 border-error
                        {% elif action.priority == 'medium' %}bg-warning/10 border-warning
                        {% else %}bg-primary/10 border-primary{% endif %}">
                        <strong class="block mb-1 text-white">{{ action.title }}</strong>
                        <span class="text-sm text-white/60">{{ action.description }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Weekly Goals -->
            <div class="mb-8">
                <div class="flex items-center gap-2 mb-4">
                    <i data-lucide="calendar-range" class="w-5 h-5 text-primary"></i>
                    <h4 class="text-lg font-semibold text-white">Wöchentliche Ziele</h4>
                </div>
                <ul class="space-y-3">
                    {% for goal in analytics.recommendations.weekly_goals or [] %}
                    <li class="p-4 bg-white/5 rounded-lg border-l-4 border-primary text-white/90">{{ goal }}</li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Optimization Tips -->
            <div class="mb-8">
                <div class="flex items-center gap-2 mb-4">
                    <i data-lucide="settings" class="w-5 h-5 text-secondary"></i>
                    <h4 class="text-lg font-semibold text-white">Optimierungstipps</h4>
                </div>
                <ul class="space-y-3">
                    {% for tip in analytics.recommendations.optimization_tips or [] %}
                    <li class="p-4 bg-white/5 rounded-lg border-l-4 border-secondary text-white/90">{{ tip }}</li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Gamification Focus -->
            <div class="mb-8">
                <div class="flex items-center gap-2 mb-4">
                    <i data-lucide="gamepad-2" class="w-5 h-5 text-secondary"></i>
                    <h4 class="text-lg font-semibold text-white">Gamification-Fokus</h4>
                </div>
                <ul class="space-y-3">
                    {% for focus in analytics.recommendations.gamification_focus or [] %}
                    <li class="p-4 bg-white/5 rounded-lg border-l-4 border-secondary text-white/90">{{ focus }}</li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Recommended Actions -->
            {% if analytics.predictions.recommended_actions %}
            <div>
                <div class="flex items-center gap-2 mb-4">
                    <i data-lucide="route" class="w-5 h-5 text-accent"></i>
                    <h4 class="text-lg font-semibold text-white">Empfohlene Aktionen</h4>
                </div>
                <ul class="space-y-3">
                    {% for action in analytics.predictions.recommended_actions %}
                    <li class="p-4 bg-white/5 rounded-lg border-l-4 border-accent text-white/90">{{ action }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Navigation -->
<div class="flex justify-center gap-4 mt-8 flex-wrap" data-aos="fade-up" data-aos-delay="600">
    <a href="{{ url_for('scoreboard.gamification_dashboard') }}" class="btn btn-primary gap-2">
        <i data-lucide="arrow-left" class="w-5 h-5"></i>
        <span>Dashboard</span>
    </a>
    <a href="{{ url_for('gamification.daily_quests') }}" class="btn gap-2 bg-secondary hover:bg-accent border-0 text-white">
        <i data-lucide="target" class="w-5 h-5"></i>
        <span>Quests</span>
    </a>
    <a href="{{ url_for('gamification.prestige_dashboard') }}" class="btn btn-accent gap-2">
        <i data-lucide="star" class="w-5 h-5"></i>
        <span>Prestige</span>
    </a>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
    // ApexCharts Dark Theme Configuration
    const apexTheme = {
        mode: 'dark',
        palette: 'palette1'
    };

    const apexChart = {
        foreColor: '#9ca3af',
        background: 'transparent',
        toolbar: {
            show: false
        }
    };

    const apexGrid = {
        borderColor: 'rgba(255, 255, 255, 0.1)',
        strokeDashArray: 3
    };

    const apexTooltip = {
        theme: 'dark',
        style: {
            fontSize: '12px'
        }
    };

    // Performance Trends Chart
    const weeklyData = {{ analytics.performance_trends.weekly_performance | tojson | safe }};

    if (weeklyData && weeklyData.length > 0) {
        const performanceOptions = {
            series: [{
                name: 'Wöchentliche Punkte',
                data: weeklyData.map(w => w.points),
                color: '#5ab1ff'
            }, {
                name: 'Wöchentliche Buchungen',
                data: weeklyData.map(w => w.bookings),
                color: '#10b981'
            }],
            chart: {
                type: 'line',
                height: 300,
                ...apexChart,
                animations: {
                    enabled: true,
                    easing: 'easeinout',
                    speed: 800
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                curve: 'smooth',
                width: 3
            },
            xaxis: {
                categories: weeklyData.map(w => w.week),
                labels: {
                    style: {
                        colors: '#9ca3af'
                    }
                }
            },
            yaxis: {
                labels: {
                    style: {
                        colors: '#9ca3af'
                    }
                }
            },
            grid: apexGrid,
            tooltip: apexTooltip,
            theme: apexTheme,
            legend: {
                position: 'top',
                horizontalAlign: 'left',
                labels: {
                    colors: '#f8fafc'
                }
            },
            fill: {
                type: 'gradient',
                gradient: {
                    shadeIntensity: 1,
                    opacityFrom: 0.7,
                    opacityTo: 0.3,
                    stops: [0, 90, 100]
                }
            }
        };

        const performanceChart = new ApexCharts(document.querySelector("#performanceChart"), performanceOptions);
        performanceChart.render();
    }

    // Seasonal Patterns Chart
    const seasonalData = {{ analytics.booking_patterns.seasonal_patterns | tojson | safe }};

    if (seasonalData && Object.keys(seasonalData).length > 0) {
        const seasonalOptions = {
            series: [{
                name: 'Buchungen pro Monat',
                data: Object.values(seasonalData),
                color: '#8b5cf6'
            }],
            chart: {
                type: 'bar',
                height: 300,
                ...apexChart
            },
            plotOptions: {
                bar: {
                    borderRadius: 8,
                    columnWidth: '60%',
                    distributed: false
                }
            },
            dataLabels: {
                enabled: false
            },
            xaxis: {
                categories: Object.keys(seasonalData),
                labels: {
                    style: {
                        colors: '#9ca3af'
                    }
                }
            },
            yaxis: {
                labels: {
                    style: {
                        colors: '#9ca3af'
                    }
                }
            },
            grid: apexGrid,
            tooltip: apexTooltip,
            theme: apexTheme,
            fill: {
                type: 'gradient',
                gradient: {
                    shade: 'dark',
                    type: 'vertical',
                    shadeIntensity: 0.5,
                    gradientToColors: ['#a78bfa'],
                    inverseColors: false,
                    opacityFrom: 0.85,
                    opacityTo: 0.85
                }
            }
        };

        const seasonalChart = new ApexCharts(document.querySelector("#seasonalChart"), seasonalOptions);
        seasonalChart.render();
    }

    // Refresh Lucide icons
    setTimeout(() => {
        lucide.createIcons();
    }, 100);
</script>
{% endblock %}
