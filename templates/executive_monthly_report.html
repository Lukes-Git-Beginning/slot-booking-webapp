{% extends "hub/base.html" %}

{% block title %}Monatliche Zusammenfassung - {{ report.meta.month_name }}{% endblock %}

{% block content %}

<!-- Report Header -->
<div class="glass rounded-3xl p-8 md:p-12 mb-8 relative bg-gradient-to-br from-secondary/20 to-primary/20" data-aos="fade-down">
    <a href="{{ url_for('admin.admin_telefonie_export_report', report_type='monthly', year=report.meta.year, month=report.meta.month) }}" class="absolute top-6 right-6 btn btn-sm btn-ghost gap-2 bg-white/10 hover:bg-white/20 border border-white/20">
        <i data-lucide="download" class="w-4 h-4"></i>
        <span>PDF Export</span>
    </a>

    <div class="text-center">
        <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">Monatliche Zusammenfassung</h1>
        <p class="text-white/70">{{ report.meta.month_name }} {{ report.meta.year }}</p>
    </div>
</div>

<!-- Key Metrics Summary -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">

    <!-- Overall Status Card -->
    <div class="glass rounded-2xl p-6 text-center
        {% if report.executive_summary.overall_status.color == 'green' %}border-2 border-success
        {% elif report.executive_summary.overall_status.color == 'yellow' %}border-2 border-warning
        {% elif report.executive_summary.overall_status.color == 'red' %}border-2 border-error
        {% endif %}" data-aos="fade-up" data-aos-delay="100">
        <div class="text-4xl mb-3">{{ report.executive_summary.overall_status.icon }}</div>
        <div class="text-5xl font-bold mb-2
            {% if report.executive_summary.overall_status.color == 'green' %}text-success
            {% elif report.executive_summary.overall_status.color == 'yellow' %}text-warning
            {% elif report.executive_summary.overall_status.color == 'red' %}text-error
            {% endif %}">
            {{ report.executive_summary.key_metrics.achievement_rate }}%
        </div>
        <div class="text-white/60 mb-3">Gesamtleistung</div>
        <div class="badge
            {% if report.executive_summary.overall_status.color == 'green' %}badge-success
            {% elif report.executive_summary.overall_status.color == 'yellow' %}badge-warning
            {% elif report.executive_summary.overall_status.color == 'red' %}badge-error
            {% endif %}">
            {{ report.executive_summary.overall_status.status }}
        </div>
    </div>

    <!-- Total Points Card -->
    <div class="glass rounded-2xl p-6 text-center" data-aos="fade-up" data-aos-delay="200">
        <div class="text-4xl mb-3">üéØ</div>
        <div class="text-5xl font-bold text-primary mb-2">{{ report.executive_summary.key_metrics.total_points_achieved }}</div>
        <div class="text-white/60 mb-3">Erreichte Punkte</div>
        <div class="text-sm text-white/50">von {{ report.executive_summary.key_metrics.total_points_goal }} Ziel</div>
    </div>

    <!-- Team Performance Card -->
    <div class="glass rounded-2xl p-6 text-center" data-aos="fade-up" data-aos-delay="300">
        <div class="text-4xl mb-3">üë•</div>
        <div class="text-5xl font-bold text-secondary mb-2">{{ report.performance_overview.team_distribution.high_performers }}</div>
        <div class="text-white/60 mb-3">Top-Performer</div>
        <div class="text-sm text-white/50">
            {{ report.performance_overview.team_distribution.medium_performers }} mittel,
            {{ report.performance_overview.team_distribution.low_performers }} brauchen Unterst√ºtzung
        </div>
    </div>

    <!-- Consistency Card -->
    <div class="glass rounded-2xl p-6 text-center" data-aos="fade-up" data-aos-delay="400">
        <div class="text-4xl mb-3">üìà</div>
        <div class="text-5xl font-bold text-secondary mb-2">{{ report.trends.consistency_score|round }}%</div>
        <div class="text-white/60 mb-3">Konsistenz</div>
        <div class="text-sm text-white/50">Team-Zuverl√§ssigkeit</div>
    </div>
</div>

<!-- Weekly Performance Overview -->
<div class="glass rounded-2xl p-8 mb-8" data-aos="fade-up" data-aos-delay="500">
    <div class="flex items-center gap-3 mb-6">
        <div class="w-12 h-12 rounded-xl bg-primary/20 flex items-center justify-center">
            <i data-lucide="calendar-days" class="w-6 h-6 text-primary"></i>
        </div>
        <h3 class="text-2xl font-bold text-white">W√∂chentliche Performance</h3>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4">
        {% for week_data in report.weekly_breakdown %}
        <div class="glass rounded-xl p-4 text-center hover:scale-105 transition-transform">
            <div class="font-semibold text-white mb-2">Woche {{ week_data.week }}</div>
            <div class="text-3xl font-bold mb-2
                {% if week_data.achievement_rate >= 90 %}text-success
                {% elif week_data.achievement_rate >= 75 %}text-warning
                {% else %}text-error{% endif %}">
                {{ week_data.achievement_rate|round }}%
            </div>
            <div class="text-sm text-white/50">{{ week_data.points_achieved }}/{{ week_data.points_goal }}</div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Team Individual Performance -->
<div class="glass rounded-2xl p-8 mb-8" data-aos="fade-up" data-aos-delay="600">
    <div class="flex items-center gap-3 mb-6">
        <div class="w-12 h-12 rounded-xl bg-secondary/20 flex items-center justify-center">
            <i data-lucide="users" class="w-6 h-6 text-secondary"></i>
        </div>
        <h3 class="text-2xl font-bold text-white">Individuelle Team-Leistung</h3>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {% for user_stat in report.detailed_breakdown.users %}
        <div class="glass rounded-xl p-4">
            <div class="flex items-center justify-between mb-3">
                <div class="font-semibold text-white">{{ user_stat.user }}</div>
                <div class="badge badge-sm
                    {% if user_stat.balance >= 0 %}badge-success
                    {% elif user_stat.balance >= -10 %}badge-warning
                    {% else %}badge-error{% endif %}">
                    {% if user_stat.balance >= 0 %}‚úÖ Ziel erreicht
                    {% elif user_stat.balance >= -10 %}‚ö†Ô∏è Knapp
                    {% else %}üö® Unter Ziel{% endif %}
                </div>
            </div>
            <div class="flex items-center justify-between">
                <div class="text-2xl font-bold text-primary">{{ user_stat.achieved }}</div>
                <div class="text-sm text-white/50">/ {{ user_stat.goal }}</div>
            </div>
            <div class="w-full bg-white/10 rounded-full h-2 mt-3">
                <div class="bg-primary h-2 rounded-full transition-all duration-500" style="width: {{ (user_stat.achieved / user_stat.goal * 100)|round }}%"></div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Trends & Insights -->
{% if report.trends %}
<div class="glass rounded-2xl p-8 mb-8" data-aos="fade-up" data-aos-delay="700">
    <div class="flex items-center gap-3 mb-6">
        <div class="w-12 h-12 rounded-xl bg-accent/20 flex items-center justify-center">
            <i data-lucide="trending-up" class="w-6 h-6 text-accent"></i>
        </div>
        <h3 class="text-2xl font-bold text-white">Trends & Erkenntnisse</h3>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-white/5 rounded-xl p-4">
            <div class="text-sm text-white/60 mb-2">Performance-Trend</div>
            <div class="flex items-center gap-2">
                <i data-lucide="{{ 'trending-up' if report.trends.trend == 'improving' else 'trending-down' if report.trends.trend == 'declining' else 'minus' }}" class="w-5 h-5
                    {% if report.trends.trend == 'improving' %}text-success
                    {% elif report.trends.trend == 'declining' %}text-error
                    {% else %}text-white/50{% endif %}"></i>
                <span class="text-lg font-semibold text-white">{{ report.trends.trend|title }}</span>
            </div>
        </div>

        <div class="bg-white/5 rounded-xl p-4">
            <div class="text-sm text-white/60 mb-2">Beste Woche</div>
            <div class="text-lg font-semibold text-white">Woche {{ report.trends.best_week.week }} - {{ report.trends.best_week.achievement_rate|round }}%</div>
        </div>

        <div class="bg-white/5 rounded-xl p-4">
            <div class="text-sm text-white/60 mb-2">Schw√§chste Woche</div>
            <div class="text-lg font-semibold text-white">Woche {{ report.trends.worst_week.week }} - {{ report.trends.worst_week.achievement_rate|round }}%</div>
        </div>

        <div class="bg-white/5 rounded-xl p-4">
            <div class="text-sm text-white/60 mb-2">√ò W√∂chentliche Leistung</div>
            <div class="text-lg font-semibold text-white">{{ report.trends.average_weekly_achievement|round }}%</div>
        </div>
    </div>
</div>
{% endif %}

<!-- Bottom Actions -->
<div class="flex justify-center gap-4 flex-wrap" data-aos="fade-up" data-aos-delay="800">
    <a href="{{ url_for('admin.admin_telefonie_export_report', report_type='monthly', year=report.meta.year, month=report.meta.month) }}" class="btn btn-primary gap-2">
        <i data-lucide="download" class="w-5 h-5"></i>
        <span>PDF-Bericht exportieren</span>
    </a>
    <a href="{{ url_for('admin.admin_reports_weekly') }}" class="btn btn-secondary gap-2">
        <i data-lucide="calendar" class="w-5 h-5"></i>
        <span>W√∂chentliche Berichte</span>
    </a>
    <a href="{{ url_for('admin.admin_telefonie') }}" class="btn btn-ghost gap-2">
        <i data-lucide="arrow-left" class="w-5 h-5"></i>
        <span>Zur√ºck zur Verwaltung</span>
    </a>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Refresh Lucide icons
    setTimeout(() => {
        lucide.createIcons();
    }, 100);
</script>
{% endblock %}
