{% extends "hub/base.html" %}

{% block title %}Prestige Dashboard - {{ current_user }}{% endblock %}

{% block content %}

<!-- Hero Section -->
<div class="glass rounded-3xl p-8 md:p-12 mb-8 bg-gradient-to-br from-purple-600/30 to-accent/30 relative overflow-hidden" data-aos="fade-down">
    <div class="absolute inset-0 opacity-20">
        <div class="absolute top-0 left-0 w-64 h-64 bg-purple-600 rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 right-0 w-64 h-64 bg-accent rounded-full blur-3xl"></div>
    </div>

    <div class="relative z-10 text-center">
        <div class="inline-block p-4 rounded-2xl bg-purple-600/20 mb-4">
            <i data-lucide="crown" class="w-16 h-16 text-purple-400"></i>
        </div>
        <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">ðŸ‘‘ Prestige System</h1>
        <p class="text-xl text-white/80">Elite-Status und Meisterschafts-Errungenschaften</p>
    </div>
</div>

<!-- Current Prestige Status -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <div class="glass rounded-2xl p-6 text-center" data-aos="fade-up" data-aos-delay="100">
        <div class="text-6xl font-bold text-purple-400 mb-2">{{ prestige_data.get('prestige_level', 0) }}</div>
        <div class="text-white/70 mb-4">Prestige Level</div>
        <div class="badge badge-lg badge-primary">{{ prestige_data.get('prestige_title', 'Neuling') }}</div>
    </div>

    <div class="glass rounded-2xl p-6 text-center" data-aos="fade-up" data-aos-delay="200">
        <div class="text-6xl font-bold text-accent mb-2">{{ prestige_data.get('prestige_points', 0) }}</div>
        <div class="text-white/70 mb-4">Prestige Punkte</div>
        <div class="badge badge-lg badge-accent">Gesamt</div>
    </div>

    <div class="glass rounded-2xl p-6 text-center" data-aos="fade-up" data-aos-delay="300">
        <div class="text-6xl font-bold text-secondary mb-2">-</div>
        <div class="text-white/70 mb-4">Globaler Rang</div>
        <div class="badge badge-lg badge-success">Top -%</div>
    </div>
</div>

<!-- Mastery Categories -->
<div class="glass rounded-3xl p-8 mb-8" data-aos="fade-up" data-aos-delay="400">
    <div class="flex items-center gap-3 mb-6">
        <div class="w-12 h-12 rounded-xl bg-primary/20 flex items-center justify-center">
            <i data-lucide="award" class="w-7 h-7 text-primary"></i>
        </div>
        <h3 class="text-2xl font-bold text-white">Meisterschafts-Kategorien</h3>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for category_id, data in mastery_progress.items() %}
        {% set category = data.get('category', {}) %}
        {% set current_level = data.get('current_level', 0) %}
        {% set metric_value = data.get('metric_value', 0) %}
        {% set next_requirement = data.get('next_requirement', 0) %}
        {% set progress_percent = data.get('progress_percent', 0) %}
        {% set current_level_info = data.get('current_level_info') %}
        <div class="glass rounded-2xl p-6 hover:scale-105 transition-transform">
            <div class="flex items-center justify-between mb-4">
                <h4 class="text-lg font-bold text-white">{{ category.get('name', category_id|title) }}</h4>
                <div class="badge
                    {% if current_level >= 5 %}badge-error
                    {% elif current_level >= 4 %}badge-warning
                    {% elif current_level >= 3 %}badge-info
                    {% elif current_level >= 1 %}badge-success
                    {% else %}badge-ghost{% endif %}">
                    {% if current_level > 0 and current_level_info %}
                        {{ current_level_info.get('emoji', '') }} Level {{ current_level }}
                    {% else %}
                        Level 0
                    {% endif %}
                </div>
            </div>

            <div class="mb-4">
                <p class="text-xs text-white/50 mb-2">{{ category.get('description', '') }}</p>
                <div class="flex justify-between text-sm text-white/60 mb-2">
                    <span>{{ metric_value }} / {{ next_requirement if next_requirement else 'âˆž' }}</span>
                    <span>{{ progress_percent|round|int }}%</span>
                </div>
                <div class="w-full bg-white/10 rounded-full h-3">
                    <div class="bg-gradient-to-r from-primary to-purple-600 h-3 rounded-full transition-all"
                         style="width: {{ progress_percent|round|int }}%"></div>
                </div>
            </div>

            <div class="text-sm text-white/60">
                {% if current_level_info %}
                <div class="bg-success/10 border border-success/30 rounded-lg p-2 text-center mb-2">
                    Aktuell: {{ current_level_info.get('name', 'Level ' ~ current_level) }} {{ current_level_info.get('emoji', '') }}
                </div>
                {% endif %}
                {% if data.get('can_upgrade') and data.get('next_level') %}
                <div class="bg-accent/10 border border-accent/30 rounded-lg p-2 text-center">
                    NÃ¤chstes Level verfÃ¼gbar! ðŸŽ‰
                </div>
                {% elif next_requirement and next_requirement > 0 %}
                <div class="bg-white/5 rounded-lg p-2 text-center text-xs">
                    {% set remaining = next_requirement - metric_value %}
                    {% if remaining > 0 %}
                    Noch {{ remaining }} bis Level {{ data.get('next_level', current_level + 1) }}
                    {% else %}
                    Bereit fÃ¼r Upgrade!
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Prestige Perks -->
{% if prestige_data.active_perks %}
<div class="glass rounded-3xl p-8 mb-8" data-aos="fade-up" data-aos-delay="500">
    <div class="flex items-center gap-3 mb-6">
        <div class="w-12 h-12 rounded-xl bg-secondary/20 flex items-center justify-center">
            <i data-lucide="sparkles" class="w-7 h-7 text-secondary"></i>
        </div>
        <h3 class="text-2xl font-bold text-white">Aktive Prestige-Vorteile</h3>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {% for perk in prestige_data.active_perks %}
        <div class="glass rounded-xl p-4 flex items-center gap-4">
            <div class="text-3xl">{{ perk.icon }}</div>
            <div class="flex-1">
                <h4 class="font-semibold text-white mb-1">{{ perk.name }}</h4>
                <p class="text-sm text-white/60">{{ perk.description }}</p>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Next Prestige Level Preview -->
{% if prestige_data.next_level_info %}
<div class="glass rounded-3xl p-8 mb-8 bg-gradient-to-br from-accent/10 to-purple-600/10" data-aos="fade-up" data-aos-delay="600">
    <div class="flex items-center gap-3 mb-6">
        <div class="w-12 h-12 rounded-xl bg-accent/20 flex items-center justify-center">
            <i data-lucide="chevrons-up" class="w-7 h-7 text-accent"></i>
        </div>
        <h3 class="text-2xl font-bold text-white">NÃ¤chstes Prestige Level</h3>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
            <div class="text-lg text-white/70 mb-2">BenÃ¶tigt:</div>
            <div class="text-4xl font-bold text-accent mb-4">{{ prestige_data.next_level_info.points_required }} Punkte</div>
            <div class="w-full bg-white/10 rounded-full h-4 mb-2">
                <div class="bg-accent h-4 rounded-full transition-all"
                     style="width: {{ prestige_data.next_level_info.progress_percent }}%"></div>
            </div>
            <div class="text-sm text-white/60">
                Noch {{ prestige_data.next_level_info.points_needed }} Punkte
            </div>
        </div>

        <div class="bg-white/5 rounded-xl p-6">
            <div class="text-lg font-semibold text-white mb-4">Freischaltbare Vorteile:</div>
            <ul class="space-y-2">
                {% for reward in prestige_data.next_level_info.unlocks %}
                <li class="flex items-center gap-2 text-white/80">
                    <i data-lucide="check-circle" class="w-4 h-4 text-secondary"></i>
                    <span>{{ reward }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endif %}

<!-- Prestige History/Timeline -->
{% if prestige_data.history %}
<div class="glass rounded-3xl p-8 mb-8" data-aos="fade-up" data-aos-delay="700">
    <div class="flex items-center gap-3 mb-6">
        <div class="w-12 h-12 rounded-xl bg-purple-600/20 flex items-center justify-center">
            <i data-lucide="clock" class="w-7 h-7 text-purple-400"></i>
        </div>
        <h3 class="text-2xl font-bold text-white">Prestige Verlauf</h3>
    </div>

    <div class="space-y-4">
        {% for entry in prestige_data.history[:5] %}
        <div class="glass rounded-xl p-4 flex items-center gap-4">
            <div class="w-16 h-16 rounded-xl bg-primary/20 flex items-center justify-center flex-shrink-0">
                <div class="text-2xl font-bold text-primary">{{ entry.level }}</div>
            </div>
            <div class="flex-1">
                <h4 class="font-semibold text-white">{{ entry.achievement }}</h4>
                <p class="text-sm text-white/60">{{ entry.date }}</p>
            </div>
            <div class="badge badge-primary">+{{ entry.points }} Punkte</div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Leaderboard Preview -->
{% if prestige_leaderboard %}
<div class="glass rounded-3xl p-8 mb-8" data-aos="fade-up" data-aos-delay="800">
    <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-3">
            <div class="w-12 h-12 rounded-xl bg-warning/20 flex items-center justify-center">
                <i data-lucide="trophy" class="w-7 h-7 text-warning"></i>
            </div>
            <h3 class="text-2xl font-bold text-white">Prestige Rangliste</h3>
        </div>
        <a href="{{ url_for('scoreboard.scoreboard') }}" class="btn btn-sm btn-ghost">
            Alle anzeigen
            <i data-lucide="arrow-right" class="w-4 h-4 ml-2"></i>
        </a>
    </div>

    <div class="space-y-3">
        {% for entry in prestige_leaderboard[:10] %}
        <div class="glass rounded-xl p-4 flex items-center gap-4 {{ 'bg-gradient-to-r from-warning/20 to-accent/20' if entry.user == current_user else '' }}">
            <div class="w-12 h-12 rounded-xl
                {% if loop.index == 1 %}bg-warning/20 text-warning
                {% elif loop.index == 2 %}bg-white/20 text-white
                {% elif loop.index == 3 %}bg-accent/20 text-accent
                {% else %}bg-white/10 text-white/60{% endif %}
                flex items-center justify-center font-bold">
                #{{ loop.index }}
            </div>
            <div class="flex-1">
                <div class="font-semibold text-white">{{ entry.user }}</div>
                <div class="text-sm text-white/60">Level {{ entry.prestige_level }}</div>
            </div>
            <div class="text-right">
                <div class="font-bold text-primary">{{ entry.prestige_points }}</div>
                <div class="text-xs text-white/60">Punkte</div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Action Buttons -->
<div class="flex justify-center gap-4 flex-wrap" data-aos="fade-up" data-aos-delay="900">
    <a href="{{ url_for('gamification.daily_quests') }}" class="btn btn-primary gap-2">
        <i data-lucide="target" class="w-5 h-5"></i>
        <span>Quests starten</span>
    </a>
    <a href="{{ url_for('scoreboard.scoreboard') }}" class="btn btn-secondary gap-2">
        <i data-lucide="trophy" class="w-5 h-5"></i>
        <span>Rangliste</span>
    </a>
    <a href="{{ url_for('scoreboard.gamification_dashboard') }}" class="btn btn-ghost gap-2">
        <i data-lucide="arrow-left" class="w-5 h-5"></i>
        <span>ZurÃ¼ck</span>
    </a>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Refresh Lucide icons
    setTimeout(() => {
        lucide.createIcons();
    }, 100);
</script>
{% endblock %}
