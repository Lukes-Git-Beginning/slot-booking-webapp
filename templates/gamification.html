{% extends "hub/base.html" %}

{% block title %}Gamification Dashboard - {{ user }}{% endblock %}

{% block content %}

<!-- Hero Section -->
<div class="glass rounded-3xl p-8 md:p-12 mb-8 bg-gradient-to-br from-primary/20 to-purple-600/20 relative overflow-hidden" data-aos="fade-down">
    <div class="absolute inset-0 opacity-10">
        <div class="absolute top-10 left-10 w-32 h-32 bg-primary rounded-full blur-3xl"></div>
        <div class="absolute bottom-10 right-10 w-32 h-32 bg-purple-600 rounded-full blur-3xl"></div>
    </div>

    <div class="relative z-10 text-center">
        <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">ðŸŽ® Gamification Dashboard</h1>
        <p class="text-xl text-white/80">Deine Gaming-Stats und Achievements</p>
    </div>
</div>

<!-- Stats Grid -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">

    <!-- Level Card -->
    <div class="glass rounded-3xl p-8" data-aos="fade-up" data-aos-delay="100">
        <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-3">
            <i data-lucide="trophy" class="w-6 h-6 text-accent"></i>
            Level & XP
        </h3>

        <div class="text-center mb-6">
            <div class="text-7xl font-bold bg-gradient-to-r from-primary to-purple-600 bg-clip-text text-transparent mb-2">
                {{ user_level.current_level|default(1) }}
            </div>
            <div class="text-lg text-white/70">{{ user_level.level_title|default('AnfÃ¤nger') }}</div>
        </div>

        <div class="mb-4">
            <div class="flex justify-between text-sm text-white/60 mb-2">
                <span>{{ user_level.current_xp|default(0) }} XP</span>
                <span>{{ user_level.xp_for_next_level|default(100) }} XP</span>
            </div>
            <div class="w-full bg-white/10 rounded-full h-4">
                <div class="bg-gradient-to-r from-primary to-purple-600 h-4 rounded-full transition-all duration-500"
                     style="width: {{ user_level.progress_percent|default(0) }}%"></div>
            </div>
            <div class="text-center text-sm text-white/60 mt-2">
                {{ user_level.xp_needed|default(100) }} XP bis Level {{ (user_level.current_level|default(1)) + 1 }}
            </div>
        </div>

        {% if user_level.next_reward %}
        <div class="bg-accent/10 border border-accent/30 rounded-xl p-4 text-center">
            <div class="text-sm text-white/70 mb-1">NÃ¤chste Belohnung:</div>
            <div class="text-white font-semibold">{{ user_level.next_reward }}</div>
        </div>
        {% endif %}
    </div>

    <!-- Badges Overview -->
    <div class="glass rounded-3xl p-8" data-aos="fade-up" data-aos-delay="200">
        <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-3">
            <i data-lucide="award" class="w-6 h-6 text-secondary"></i>
            Badges Ãœbersicht
        </h3>

        <div class="grid grid-cols-3 gap-4 mb-6">
            <div class="text-center">
                <div class="text-4xl font-bold text-primary">{{ badge_stats.total_earned }}</div>
                <div class="text-sm text-white/60">Erhalten</div>
            </div>
            <div class="text-center">
                <div class="text-4xl font-bold text-warning">{{ badge_stats.total_available }}</div>
                <div class="text-sm text-white/60">VerfÃ¼gbar</div>
            </div>
            <div class="text-center">
                <div class="text-4xl font-bold text-secondary">{{ badge_stats.completion_rate }}%</div>
                <div class="text-sm text-white/60">Abschluss</div>
            </div>
        </div>

        <div class="space-y-3">
            {% for rarity, count in badge_stats.by_rarity.items() %}
            <div class="flex items-center justify-between bg-white/5 rounded-lg p-3">
                <span class="text-white/80">{{ rarity|title }}</span>
                <span class="badge
                    {% if rarity == 'mythisch' %}badge-error
                    {% elif rarity == 'legendÃ¤r' %}badge-warning
                    {% elif rarity == 'episch' %}badge-info
                    {% elif rarity == 'selten' %}badge-primary
                    {% else %}badge-ghost{% endif %}">
                    {{ count }}
                </span>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Recent Badges -->
{% if recent_badges %}
<div class="glass rounded-3xl p-8 mb-8" data-aos="fade-up" data-aos-delay="300">
    <h3 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
        <i data-lucide="sparkles" class="w-7 h-7 text-accent"></i>
        Neueste Badges
    </h3>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {% for badge in recent_badges[:6] %}
        <div class="glass rounded-2xl p-6 hover:scale-105 transition-transform">
            <div class="text-4xl mb-3 text-center">{{ badge.icon }}</div>
            <h4 class="font-bold text-white text-center mb-2">{{ badge.name }}</h4>
            <p class="text-sm text-white/60 text-center mb-3">{{ badge.description }}</p>
            <div class="text-center">
                <span class="badge badge-sm
                    {% if badge.rarity == 'mythisch' %}badge-error
                    {% elif badge.rarity == 'legendÃ¤r' %}badge-warning
                    {% elif badge.rarity == 'episch' %}badge-info
                    {% elif badge.rarity == 'selten' %}badge-primary
                    {% else %}badge-ghost{% endif %}">
                    {{ badge.rarity|title }}
                </span>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Prestige System -->
{% if prestige_info %}
<div class="glass rounded-3xl p-8 mb-8 bg-gradient-to-br from-purple-600/10 to-accent/10" data-aos="fade-up" data-aos-delay="400">
    <div class="flex items-center gap-3 mb-6">
        <div class="w-12 h-12 rounded-xl bg-purple-600/20 flex items-center justify-center">
            <i data-lucide="crown" class="w-7 h-7 text-purple-400"></i>
        </div>
        <h3 class="text-2xl font-bold text-white">Prestige Status</h3>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="text-center">
            <div class="text-5xl font-bold text-purple-400 mb-2">{{ prestige_info.level }}</div>
            <div class="text-white/70">Prestige Level</div>
        </div>
        <div class="text-center">
            <div class="text-5xl font-bold text-accent mb-2">{{ prestige_info.total_points }}</div>
            <div class="text-white/70">Prestige Punkte</div>
        </div>
        <div class="text-center">
            <div class="text-5xl font-bold text-secondary mb-2">{{ prestige_info.tier|title }}</div>
            <div class="text-white/70">Prestige Tier</div>
        </div>
    </div>

    <div class="mt-6 text-center">
        <a href="{{ url_for('gamification.prestige_dashboard') }}" class="btn btn-primary gap-2">
            <i data-lucide="crown" class="w-5 h-5"></i>
            <span>Prestige Dashboard</span>
        </a>
    </div>
</div>
{% endif %}

<!-- Daily Quests Preview -->
{% if active_quests %}
<div class="glass rounded-3xl p-8 mb-8" data-aos="fade-up" data-aos-delay="500">
    <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold text-white flex items-center gap-3">
            <i data-lucide="target" class="w-7 h-7 text-primary"></i>
            TÃ¤gliche Quests
        </h3>
        <a href="{{ url_for('gamification.daily_quests') }}" class="btn btn-sm btn-ghost">
            Alle anzeigen
            <i data-lucide="arrow-right" class="w-4 h-4 ml-2"></i>
        </a>
    </div>

    <div class="space-y-4">
        {% for quest in active_quests[:3] %}
        <div class="glass rounded-xl p-4">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-3">
                    <div class="text-2xl">{{ quest.icon }}</div>
                    <div>
                        <h4 class="font-semibold text-white">{{ quest.name }}</h4>
                        <p class="text-sm text-white/60">{{ quest.description }}</p>
                    </div>
                </div>
                <div class="badge badge-primary">{{ quest.reward }} XP</div>
            </div>
            <div class="flex items-center gap-3">
                <div class="flex-1 bg-white/10 rounded-full h-2">
                    <div class="bg-primary h-2 rounded-full transition-all"
                         style="width: {{ quest.progress_percent }}%"></div>
                </div>
                <span class="text-sm text-white/60">{{ quest.current }}/{{ quest.target }}</span>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Action Buttons -->
<div class="flex justify-center gap-4 flex-wrap" data-aos="fade-up" data-aos-delay="600">
    <a href="{{ url_for('gamification.daily_quests') }}" class="btn btn-primary gap-2">
        <i data-lucide="target" class="w-5 h-5"></i>
        <span>TÃ¤gliche Quests</span>
    </a>
    <a href="{{ url_for('gamification.prestige_dashboard') }}" class="btn gap-2 bg-purple-600 hover:bg-purple-700 border-0 text-white">
        <i data-lucide="crown" class="w-5 h-5"></i>
        <span>Prestige</span>
    </a>
    <a href="{{ url_for('gamification.cosmetics_shop') }}" class="btn btn-accent gap-2">
        <i data-lucide="shopping-bag" class="w-5 h-5"></i>
        <span>Shop</span>
    </a>
    <a href="{{ url_for('scoreboard.gamification_dashboard') }}" class="btn btn-ghost gap-2">
        <i data-lucide="arrow-left" class="w-5 h-5"></i>
        <span>ZurÃ¼ck</span>
    </a>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Refresh Lucide icons
    setTimeout(() => {
        lucide.createIcons();
    }, 100);
</script>
{% endblock %}
