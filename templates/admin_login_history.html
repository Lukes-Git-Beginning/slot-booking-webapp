{% extends "hub/base.html" %}

{% block title %}Login History{% endblock %}

{% block content %}

<!-- Header -->
<div class="glass rounded-3xl p-8 md:p-12 mb-8" data-aos="fade-down">
    <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-4">
            <div class="w-16 h-16 rounded-2xl bg-info/20 flex items-center justify-center">
                <i data-lucide="bar-chart-3" class="w-10 h-10 text-info"></i>
            </div>
            <div>
                <h1 class="text-3xl md:text-4xl font-bold text-white">Login History</h1>
                <p class="text-white/70 mt-1">Benutzer-Aktivitäten der letzten 30 Tage · {{ current_time }}</p>
            </div>
        </div>
        <a href="{{ url_for('admin.admin_dashboard') }}" class="btn btn-ghost gap-2">
            <i data-lucide="arrow-left" class="w-5 h-5"></i>
            <span>Zurück</span>
        </a>
    </div>
</div>

<!-- Login Stats -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <div class="glass rounded-2xl p-6" data-aos="fade-up" data-aos-delay="100">
        <div class="flex items-center gap-3 mb-3">
            <i data-lucide="log-in" class="w-6 h-6 text-success"></i>
            <h3 class="font-semibold text-white">Erfolgreiche Logins</h3>
        </div>
        <div class="text-4xl font-bold text-success">{{ login_stats.successful_logins }}</div>
        <p class="text-white/60 text-sm mt-2">Letzte 30 Tage</p>
    </div>

    <div class="glass rounded-2xl p-6" data-aos="fade-up" data-aos-delay="200">
        <div class="flex items-center gap-3 mb-3">
            <i data-lucide="shield-alert" class="w-6 h-6 text-error"></i>
            <h3 class="font-semibold text-white">Fehlgeschlagene</h3>
        </div>
        <div class="text-4xl font-bold text-error">{{ login_stats.failed_logins }}</div>
        <p class="text-white/60 text-sm mt-2">Failed Attempts</p>
    </div>

    <div class="glass rounded-2xl p-6" data-aos="fade-up" data-aos-delay="300">
        <div class="flex items-center gap-3 mb-3">
            <i data-lucide="globe" class="w-6 h-6 text-primary"></i>
            <h3 class="font-semibold text-white">Unique IPs</h3>
        </div>
        <div class="text-4xl font-bold text-primary">{{ login_stats.unique_ips }}</div>
        <p class="text-white/60 text-sm mt-2">Verschiedene Standorte</p>
    </div>

    <div class="glass rounded-2xl p-6" data-aos="fade-up" data-aos-delay="400">
        <div class="flex items-center gap-3 mb-3">
            <i data-lucide="clock" class="w-6 h-6 text-warning"></i>
            <h3 class="font-semibold text-white">Peak Hour</h3>
        </div>
        <div class="text-4xl font-bold text-warning">{{ login_stats.peak_hour }}:00</div>
        <p class="text-white/60 text-sm mt-2">Höchste Aktivität</p>
    </div>
</div>

<!-- Recent Logins Table -->
<div class="glass rounded-3xl p-8" data-aos="fade-up" data-aos-delay="500">
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-white flex items-center gap-3">
            <i data-lucide="history" class="w-6 h-6 text-info"></i>
            Letzte 50 Logins
        </h2>
        <div class="flex gap-2">
            <div class="badge badge-success gap-1">
                <i data-lucide="check" class="w-3 h-3"></i>
                Erfolgreich
            </div>
            <div class="badge badge-error gap-1">
                <i data-lucide="x" class="w-3 h-3"></i>
                Fehlgeschlagen
            </div>
        </div>
    </div>

    {% if all_logins %}
    <div class="overflow-x-auto">
        <table class="table table-zebra w-full">
            <thead>
                <tr class="bg-white/5 border-b border-white/10">
                    <th class="text-white font-bold">Zeitstempel</th>
                    <th class="text-white font-bold">Benutzer</th>
                    <th class="text-white font-bold">Status</th>
                    <th class="text-white font-bold">IP-Adresse</th>
                    <th class="text-white font-bold">Browser / Device</th>
                </tr>
            </thead>
            <tbody>
                {% for login in all_logins %}
                <tr class="hover:bg-white/5 transition-colors">
                    <!-- Timestamp -->
                    <td>
                        <div class="flex items-center gap-2 text-white/90">
                            <i data-lucide="clock" class="w-4 h-4 text-white/60"></i>
                            <span>{{ login.timestamp }}</span>
                        </div>
                    </td>

                    <!-- Username -->
                    <td>
                        <div class="flex items-center gap-2">
                            <div class="avatar placeholder">
                                <div class="{% if login.success %}bg-success/20 text-success{% else %}bg-error/20 text-error{% endif %} rounded-full w-8 h-8 flex items-center justify-center">
                                    <i data-lucide="user" class="w-4 h-4"></i>
                                </div>
                            </div>
                            <span class="font-semibold text-white">{{ login.username }}</span>
                        </div>
                    </td>

                    <!-- Status -->
                    <td>
                        {% if login.success %}
                        <div class="badge badge-success gap-1">
                            <i data-lucide="check" class="w-3 h-3"></i>
                            Erfolgreich
                        </div>
                        {% else %}
                        <div class="badge badge-error gap-1">
                            <i data-lucide="x" class="w-3 h-3"></i>
                            Fehlgeschlagen
                        </div>
                        {% endif %}
                    </td>

                    <!-- IP Address -->
                    <td>
                        <div class="flex items-center gap-2 text-white/70 font-mono text-sm">
                            <i data-lucide="globe" class="w-4 h-4 text-primary"></i>
                            {{ login.ip_address }}
                        </div>
                    </td>

                    <!-- User Agent (Browser/Device) -->
                    <td>
                        <div class="text-white/60 text-xs max-w-xs truncate" title="{{ login.user_agent }}">
                            {% if 'Chrome' in login.user_agent %}
                                <i data-lucide="chrome" class="w-3 h-3 inline mr-1"></i>Chrome
                            {% elif 'Firefox' in login.user_agent %}
                                <i data-lucide="firefox" class="w-3 h-3 inline mr-1"></i>Firefox
                            {% elif 'Safari' in login.user_agent %}
                                <i data-lucide="compass" class="w-3 h-3 inline mr-1"></i>Safari
                            {% elif 'Edge' in login.user_agent %}
                                <i data-lucide="layout" class="w-3 h-3 inline mr-1"></i>Edge
                            {% else %}
                                <i data-lucide="monitor" class="w-3 h-3 inline mr-1"></i>
                            {% endif %}

                            {% if 'Mobile' in login.user_agent or 'Android' in login.user_agent or 'iPhone' in login.user_agent %}
                                <i data-lucide="smartphone" class="w-3 h-3 inline ml-1"></i>
                            {% else %}
                                <i data-lucide="monitor" class="w-3 h-3 inline ml-1"></i>
                            {% endif %}

                            <span class="ml-1">{{ login.user_agent[:50] }}{% if login.user_agent|length > 50 %}...{% endif %}</span>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination Info -->
    <div class="mt-6 text-center text-white/60 text-sm">
        Zeige die letzten 50 Login-Versuche
    </div>

    {% else %}
    <div class="text-center py-12">
        <i data-lucide="inbox" class="w-16 h-16 text-white/30 mx-auto mb-4"></i>
        <p class="text-white/60 text-lg">Keine Login-History gefunden</p>
        <p class="text-white/40 text-sm mt-2">Login-Aktivitäten werden ab jetzt getrackt</p>
    </div>
    {% endif %}
</div>

<!-- Additional Info -->
<div class="glass rounded-2xl p-6 mt-8" data-aos="fade-up" data-aos-delay="600">
    <div class="flex items-start gap-3">
        <i data-lucide="info" class="w-5 h-5 text-info mt-1"></i>
        <div class="flex-1">
            <h3 class="font-semibold text-white mb-2">Tracking-Informationen</h3>
            <ul class="text-white/60 text-sm space-y-1 list-disc list-inside">
                <li>Login-Versuche werden mit Zeitstempel, IP-Adresse und Browser-Info gespeichert</li>
                <li>Fehlgeschlagene Logins können auf Sicherheitsprobleme hinweisen</li>
                <li>Ungewöhnliche IP-Adressen sollten überprüft werden</li>
                <li>Sessions werden nach 15 Minuten Inaktivität als offline markiert</li>
            </ul>
        </div>
    </div>
</div>

{% endblock %}
