{% extends "hub/base.html" %}

{% block title %}Fehler {{ error_code }}{% endblock %}

{% block content %}

<!-- Error Display -->
<div class="min-h-[80vh] flex items-center justify-center px-4">
    <div class="glass rounded-3xl p-8 md:p-12 max-w-2xl w-full bg-gradient-to-br from-error/20 to-warning/20 relative overflow-hidden" data-aos="zoom-in">
        <div class="absolute inset-0 opacity-20">
            <div class="absolute top-10 left-10 w-40 h-40 bg-error rounded-full blur-3xl"></div>
            <div class="absolute bottom-10 right-10 w-40 h-40 bg-warning rounded-full blur-3xl"></div>
        </div>

        <div class="relative z-10 text-center">
            <!-- Error Icon -->
            <div class="inline-block p-6 rounded-full bg-error/20 mb-6" data-aos="fade-down" data-aos-delay="100">
                <i data-lucide="alert-triangle" class="w-24 h-24 text-error"></i>
            </div>

            <!-- Error Code -->
            <div class="text-7xl md:text-8xl font-bold text-error mb-4" data-aos="fade-up" data-aos-delay="200">
                {{ error_code or 500 }}
            </div>

            <!-- Error Message -->
            <h1 class="text-2xl md:text-3xl font-bold text-white mb-3" data-aos="fade-up" data-aos-delay="300">
                Ups, da ist etwas schief gelaufen!
            </h1>

            <p class="text-lg text-white/80 mb-8" data-aos="fade-up" data-aos-delay="400">
                {{ error_message or "Ein unerwarteter Fehler ist aufgetreten" }}
            </p>

            <!-- Error Details -->
            {% if error_details %}
            <div class="glass rounded-xl p-4 mb-8 text-left" data-aos="fade-up" data-aos-delay="500">
                <div class="flex items-center gap-2 mb-3">
                    <i data-lucide="info" class="w-5 h-5 text-primary"></i>
                    <h3 class="font-semibold text-white">Details:</h3>
                </div>
                <p class="text-sm text-white/70 font-mono">{{ error_details }}</p>
            </div>
            {% endif %}

            <!-- Action Buttons -->
            <div class="flex flex-wrap gap-4 justify-center" data-aos="fade-up" data-aos-delay="600">
                <a href="/" class="btn btn-primary gap-2">
                    <i data-lucide="home" class="w-5 h-5"></i>
                    <span>Zur Startseite</span>
                </a>

                {% if current_user %}
                <a href="{{ url_for('scoreboard.gamification_dashboard') }}" class="btn btn-secondary gap-2">
                    <i data-lucide="trophy" class="w-5 h-5"></i>
                    <span>Dashboard</span>
                </a>
                {% endif %}

                <button onclick="window.history.back()" class="btn btn-ghost gap-2">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                    <span>Zurück</span>
                </button>
            </div>

            <!-- Error Code Reference -->
            <div class="mt-8 pt-6 border-t border-white/10" data-aos="fade-up" data-aos-delay="700">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-white/60">
                    <div class="flex items-center justify-center gap-2">
                        <i data-lucide="clock" class="w-4 h-4"></i>
                        <span>{{ current_time or 'Zeitstempel nicht verfügbar' }}</span>
                    </div>
                    <div class="flex items-center justify-center gap-2">
                        <i data-lucide="code" class="w-4 h-4"></i>
                        <span>Error {{ error_code or 'UNKNOWN' }}</span>
                    </div>
                    <div class="flex items-center justify-center gap-2">
                        <i data-lucide="help-circle" class="w-4 h-4"></i>
                        <a href="mailto:support@example.com" class="hover:text-primary transition-colors">Support</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Common Error Codes Reference (Optional) -->
{% if show_error_guide %}
<div class="glass rounded-3xl p-8 mt-8" data-aos="fade-up" data-aos-delay="800">
    <div class="flex items-center gap-3 mb-6">
        <div class="w-12 h-12 rounded-xl bg-primary/20 flex items-center justify-center">
            <i data-lucide="book-open" class="w-7 h-7 text-primary"></i>
        </div>
        <h2 class="text-2xl font-bold text-white">Häufige Fehlercodes</h2>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="glass rounded-xl p-4">
            <div class="flex items-center gap-3 mb-2">
                <div class="badge badge-error">404</div>
                <h3 class="font-semibold text-white">Nicht gefunden</h3>
            </div>
            <p class="text-sm text-white/60">Die angeforderte Seite existiert nicht.</p>
        </div>

        <div class="glass rounded-xl p-4">
            <div class="flex items-center gap-3 mb-2">
                <div class="badge badge-warning">403</div>
                <h3 class="font-semibold text-white">Zugriff verweigert</h3>
            </div>
            <p class="text-sm text-white/60">Sie haben keine Berechtigung für diese Aktion.</p>
        </div>

        <div class="glass rounded-xl p-4">
            <div class="flex items-center gap-3 mb-2">
                <div class="badge badge-error">500</div>
                <h3 class="font-semibold text-white">Serverfehler</h3>
            </div>
            <p class="text-sm text-white/60">Ein interner Serverfehler ist aufgetreten.</p>
        </div>

        <div class="glass rounded-xl p-4">
            <div class="flex items-center gap-3 mb-2">
                <div class="badge badge-info">503</div>
                <h3 class="font-semibold text-white">Service nicht verfügbar</h3>
            </div>
            <p class="text-sm text-white/60">Der Dienst ist vorübergehend nicht verfügbar.</p>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
    // Refresh Lucide icons
    setTimeout(() => {
        lucide.createIcons();
    }, 100);

    // Optional: Auto-redirect after timeout for certain errors
    {% if auto_redirect_seconds %}
    let countdown = {{ auto_redirect_seconds }};
    const countdownInterval = setInterval(() => {
        countdown--;
        if (countdown <= 0) {
            clearInterval(countdownInterval);
            window.location.href = '{{ auto_redirect_url or "/" }}';
        }
    }, 1000);
    {% endif %}
</script>
{% endblock %}
