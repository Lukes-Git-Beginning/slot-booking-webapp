{% extends "hub/base.html" %}

{% block title %}W√∂chentliche Zusammenfassung - Woche {{ report.meta.week }}{% endblock %}

{% block content %}

<!-- Report Header -->
<div class="glass rounded-3xl p-8 md:p-12 mb-8 relative" data-aos="fade-down">
    <a href="{{ url_for('admin.admin_telefonie_export_report', report_type='weekly', week=report.meta.week) }}" class="absolute top-6 right-6 btn btn-sm btn-ghost gap-2 bg-white/10 hover:bg-white/20 border border-white/20">
        <i data-lucide="download" class="w-4 h-4"></i>
        <span>PDF Export</span>
    </a>

    <div class="text-center">
        <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">W√∂chentliche Zusammenfassung</h1>
        <p class="text-white/70">Week {{ report.meta.week }} ({{ report.meta.week_start }} - {{ report.meta.week_end }})</p>
    </div>
</div>

<!-- Key Metrics Summary -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">

    <!-- Overall Status Card -->
    <div class="glass rounded-2xl p-6 text-center
        {% if report.executive_summary.overall_status.color == 'green' %}border-2 border-success
        {% elif report.executive_summary.overall_status.color == 'yellow' %}border-2 border-warning
        {% elif report.executive_summary.overall_status.color == 'red' %}border-2 border-error
        {% endif %}" data-aos="fade-up" data-aos-delay="100">
        <div class="text-4xl mb-3">{{ report.executive_summary.overall_status.icon }}</div>
        <div class="text-5xl font-bold mb-2
            {% if report.executive_summary.overall_status.color == 'green' %}text-success
            {% elif report.executive_summary.overall_status.color == 'yellow' %}text-warning
            {% elif report.executive_summary.overall_status.color == 'red' %}text-error
            {% endif %}">
            {{ report.executive_summary.key_metrics.achievement_rate }}%
        </div>
        <div class="text-white/60 mb-3">Team-Leistung</div>
        <div class="badge
            {% if report.executive_summary.overall_status.color == 'green' %}badge-success
            {% elif report.executive_summary.overall_status.color == 'yellow' %}badge-warning
            {% elif report.executive_summary.overall_status.color == 'red' %}badge-error
            {% endif %}">
            {{ report.executive_summary.overall_status.status }}
        </div>
    </div>

    <!-- Points Achieved Card -->
    <div class="glass rounded-2xl p-6 text-center" data-aos="fade-up" data-aos-delay="200">
        <div class="text-4xl mb-3">üéØ</div>
        <div class="text-5xl font-bold text-primary mb-2">{{ report.executive_summary.key_metrics.total_points_achieved }}</div>
        <div class="text-white/60 mb-3">Erreichte Punkte</div>
        <div class="text-sm text-white/50">von {{ report.executive_summary.key_metrics.total_points_goal }} Ziel</div>
    </div>

    <!-- Top Performers Card -->
    <div class="glass rounded-2xl p-6 text-center" data-aos="fade-up" data-aos-delay="300">
        <div class="text-4xl mb-3">üë•</div>
        <div class="text-5xl font-bold text-primary mb-2">{{ report.performance_overview.team_distribution.high_performers }}</div>
        <div class="text-white/60 mb-3">Top-Performer</div>
        <div class="text-sm text-white/50">
            {{ report.performance_overview.team_distribution.medium_performers }} mittel,
            {{ report.performance_overview.team_distribution.low_performers }} brauchen Unterst√ºtzung
        </div>
    </div>

    <!-- Absence Card -->
    {% if report.absence_analysis.total_absent > 0 %}
    <div class="glass rounded-2xl p-6 text-center" data-aos="fade-up" data-aos-delay="400">
        <div class="text-4xl mb-3">üèñÔ∏è</div>
        <div class="text-5xl font-bold text-warning mb-2">{{ report.absence_analysis.absence_rate }}%</div>
        <div class="text-white/60 mb-3">Team Abwesend</div>
        <div class="text-sm text-white/50">{{ report.absence_analysis.total_absent }} Personen abwesend</div>
    </div>
    {% endif %}
</div>

<!-- Team Overview -->
<div class="glass rounded-2xl p-8 mb-8" data-aos="fade-up" data-aos-delay="500">
    <div class="flex items-center gap-3 mb-6">
        <div class="w-12 h-12 rounded-xl bg-primary/20 flex items-center justify-center">
            <i data-lucide="users" class="w-6 h-6 text-primary"></i>
        </div>
        <h3 class="text-2xl font-bold text-white">Team-Leistung Diese Woche</h3>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
        {% for user_stat in report.detailed_breakdown.users %}
        <div class="glass rounded-xl p-4 text-center hover:scale-105 transition-transform">
            <div class="font-semibold text-white mb-2">{{ user_stat.user }}</div>
            <div class="text-3xl font-bold mb-2 {{ 'text-success' if user_stat.balance >= 0 else 'text-error' }}">
                {{ user_stat.achieved }}/{{ user_stat.goal }}
            </div>
            <div class="badge badge-sm
                {% if user_stat.on_vacation %}badge-info
                {% elif user_stat.balance >= 0 %}badge-success
                {% elif user_stat.balance >= -5 %}badge-warning
                {% else %}badge-error{% endif %}">
                {% if user_stat.on_vacation %}üèñÔ∏è Urlaub
                {% elif user_stat.balance >= 0 %}‚úÖ Im Plan
                {% elif user_stat.balance >= -5 %}‚ö†Ô∏è R√ºckstand
                {% else %}üö® Handlung erforderlich{% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Bottom Actions -->
<div class="flex justify-center gap-4 flex-wrap" data-aos="fade-up" data-aos-delay="600">
    <a href="{{ url_for('admin.admin_telefonie_export_report', report_type='weekly', week=report.meta.week) }}" class="btn btn-primary gap-2">
        <i data-lucide="download" class="w-5 h-5"></i>
        <span>PDF-Bericht exportieren</span>
    </a>
    <a href="{{ url_for('admin.admin_reports_monthly') }}" class="btn btn-secondary gap-2">
        <i data-lucide="calendar" class="w-5 h-5"></i>
        <span>Monatsbericht anzeigen</span>
    </a>
    <a href="{{ url_for('admin.admin_telefonie') }}" class="btn btn-ghost gap-2">
        <i data-lucide="arrow-left" class="w-5 h-5"></i>
        <span>Zur√ºck zur Verwaltung</span>
    </a>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Refresh Lucide icons
    setTimeout(() => {
        lucide.createIcons();
    }, 100);
</script>
{% endblock %}
