<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>üìä Admin Dashboard - Analytics & ML Insights</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='admin_style.css') }}">
  <link href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@2.47.0/tabler-icons.min.css" rel="stylesheet">
  
  <!-- Chart.js f√ºr Grafiken -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  
  <style>
    .admin-dashboard {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .dashboard-header {
      background: linear-gradient(135deg, rgba(90,177,255,0.15), rgba(16,185,129,0.15), rgba(139,92,246,0.1));
      border-radius: var(--radius-lg);
      padding: 40px;
      margin-bottom: 30px;
      text-align: center;
      border: 1px solid var(--accent);
      box-shadow: 0 10px 30px rgba(90,177,255,0.1);
      position: relative;
      overflow: hidden;
    }
    
    .dashboard-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.05) 50%, transparent 70%);
      animation: shimmer 3s infinite;
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    .dashboard-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--accent);
      margin: 0 0 10px;
    }
    
    .dashboard-subtitle {
      color: var(--muted);
      margin: 0;
    }
    
    .running-time {
      background: rgba(16,185,129,0.15);
      color: #10b981;
      padding: 8px 16px;
      border-radius: 20px;
      display: inline-block;
      margin-top: 10px;
      font-weight: 600;
    }
    
    /* Stats Grid */
    .stats-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: var(--radius-lg);
      padding: 25px;
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent), #3d8bfd);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(90,177,255,0.15);
      border-color: var(--accent);
    }
    
    .stat-card:hover::before {
      transform: scaleX(1);
    }
    
    .stat-icon {
      font-size: 40px;
      margin-bottom: 15px;
    }
    
    .stat-value {
      font-size: 32px;
      font-weight: 700;
      margin: 10px 0;
      color: var(--accent);
    }
    
    .stat-label {
      color: var(--muted);
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .stat-change {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 12px;
      margin-top: 8px;
      display: inline-block;
    }
    
    .stat-change.positive {
      background: rgba(16,185,129,0.2);
      color: #10b981;
    }
    
    .stat-change.negative {
      background: rgba(239,68,68,0.2);
      color: #ef4444;
    }
    
    /* Chart Container */
    .charts-section {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }
    
    .chart-container {
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: var(--radius-lg);
      padding: 25px;
    }
    
    .chart-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 20px;
      color: var(--text-color);
    }
    
    .chart-canvas {
      position: relative;
      height: 300px;
    }
    
    /* Tabs */
    .analysis-tabs {
      display: flex;
      background: var(--box-bg);
      border-radius: var(--radius-lg);
      padding: 4px;
      margin-bottom: 20px;
      border: 1px solid var(--box-border);
    }
    
    .tab-btn {
      flex: 1;
      padding: 12px 20px;
      background: none;
      border: none;
      border-radius: var(--radius-md);
      color: var(--muted);
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
    }
    
    .tab-btn.active {
      background: var(--accent);
      color: white;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Tables */
    .analysis-table {
      width: 100%;
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      margin-bottom: 20px;
    }
    
    .analysis-table th,
    .analysis-table td {
      padding: 15px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      text-align: left;
    }
    
    .analysis-table thead th {
      background: rgba(90,177,255,0.1);
      color: var(--accent);
      font-weight: 600;
    }
    
    /* Risk Analysis */
    .risk-analysis {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .risk-card {
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: var(--radius-lg);
      padding: 20px;
    }
    
    .risk-card.high-risk {
      border-color: rgba(239,68,68,0.5);
      background: rgba(239,68,68,0.05);
    }
    
    .risk-card.medium-risk {
      border-color: rgba(234,179,8,0.5);
      background: rgba(234,179,8,0.05);
    }
    
    .risk-card.low-risk {
      border-color: rgba(16,185,129,0.5);
      background: rgba(16,185,129,0.05);
    }
    
    .risk-title {
      font-weight: 600;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .customer-list {
      max-height: 200px;
      overflow-y: auto;
    }
    
    .customer-item {
      padding: 8px 12px;
      margin-bottom: 8px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    /* ML Insights */
    .ml-section {
      background: linear-gradient(135deg, rgba(139,92,246,0.15), rgba(236,72,153,0.15));
      border: 1px solid rgba(139,92,246,0.3);
      border-radius: var(--radius-lg);
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(139,92,246,0.1);
      position: relative;
    }
    
    .ml-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(139,92,246,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
      border-radius: var(--radius-lg);
      pointer-events: none;
    }
    
    .ml-title {
      font-size: 24px;
      font-weight: 700;
      color: #8b5cf6;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .readiness-score {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .score-circle {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 700;
      color: white;
      position: relative;
    }
    
    .score-circle.ready {
      background: linear-gradient(135deg, #10b981, #059669);
    }
    
    .score-circle.partial {
      background: linear-gradient(135deg, #f59e0b, #d97706);
    }
    
    .score-circle.not-ready {
      background: linear-gradient(135deg, #ef4444, #dc2626);
    }
    
    .model-recommendations {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .model-card {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: var(--radius-md);
      padding: 20px;
    }
    
    /* Export Button */
    .export-section {
      text-align: center;
      padding: 30px;
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: var(--radius-lg);
      margin-bottom: 30px;
    }
    
    .export-btn {
      background: linear-gradient(135deg, var(--accent), #3d8bfd);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: var(--radius-md);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .export-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(90,177,255,0.4);
    }
    
    /* Quick Actions */
    .quick-actions {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .action-btn {
      padding: 10px 20px;
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: var(--radius-sm);
      color: var(--text-color);
      text-decoration: none;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .action-btn:hover {
      transform: translateY(-2px);
      border-color: var(--accent);
    }
    
    /* Mobile Responsive */
    @media (max-width: 768px) {
      .charts-section {
        grid-template-columns: 1fr;
      }
      
      .stats-overview {
        grid-template-columns: 1fr 1fr;
      }
      
      .risk-analysis {
        grid-template-columns: 1fr;
      }
      
      .model-recommendations {
        grid-template-columns: 1fr;
      }
      
      .quick-actions {
        flex-direction: column;
      }
    }
    
    /* Glass Panel Utility */
    .glass {
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: var(--radius-lg);
      padding: 25px;
    }
    
    .panel {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="admin-dashboard">
    
    <!-- Header -->
    <div class="dashboard-header">
      <h1 class="dashboard-title">ü§ñ Admin Analytics Dashboard</h1>
      <p class="dashboard-subtitle">Machine Learning Insights & Performance Analytics</p>
      <div class="running-time">
        ‚ú® System l√§uft seit {{ days_running }} Tagen
      </div>
      <div class="color-status-info" style="margin-top: 15px; font-size: 0.9em; color: var(--muted);">
        üé® Color-Mapping: {{ color_status.total_colors }} Farben konfiguriert 
        ({{ color_status.blocking|length }} blockierend, {{ color_status.non_blocking|length }} nicht-blockierend)
      </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="quick-actions">
      <a href="{{ url_for('index') }}" class="action-btn">
        <i class="ti ti-arrow-left"></i> Zur√ºck zur App
      </a>
      <a href="{{ url_for('admin_insights') }}" class="action-btn">
        <i class="ti ti-brain"></i> Detaillierte Insights
      </a>
      <a href="{{ url_for('export_analytics') }}" class="action-btn">
        <i class="ti ti-download"></i> Daten Export
      </a>
      <a href="#admin-tools" class="action-btn">
        <i class="ti ti-tools"></i> Admin Tools
      </a>
      <button class="action-btn" onclick="refreshDashboard()">
        <i class="ti ti-refresh"></i> Aktualisieren
      </button>
    </div>
    
    <!-- Stats Overview -->
    <div class="stats-overview">
      <div class="stat-card">
        <div class="stat-icon">üìä</div>
        <div class="stat-value">{{ dashboard.last_7_days.total_slots or 0 }}</div>
        <div class="stat-label">Termine (7 Tage)</div>
        {% if dashboard.trends and dashboard.trends.no_show_trend %}
        <div class="stat-change {{ 'negative' if dashboard.trends.no_show_trend.direction == 'up' else 'positive' }}">
          {{ dashboard.trends.no_show_trend.change }}% vs. letzte Woche
        </div>
        {% endif %}
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">‚ö†Ô∏è</div>
        <div class="stat-value">{{ "%.1f"|format(dashboard.last_7_days.no_show_rate or 0) }}%</div>
        <div class="stat-label">No-Show Rate</div>
        <div class="stat-change {{ 'positive' if (dashboard.last_7_days.no_show_rate or 0) < 20 else 'negative' }}">
          {{ dashboard.last_7_days.no_shows or 0 }} von {{ dashboard.last_7_days.total_slots or 0 }}
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">‚úÖ</div>
        <div class="stat-value">{{ "%.1f"|format(dashboard.last_7_days.completion_rate or 0) }}%</div>
        <div class="stat-label">Erfolgsquote</div>
        <div class="stat-change positive">
          {{ dashboard.last_7_days.completed or 0 }} erfolgreich
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">üë•</div>
        <div class="stat-value">{{ risk_analysis.high_risk_customers|length + risk_analysis.improvement_candidates|length + risk_analysis.loyal_customers|length + risk_analysis.new_customers|length }}</div>
        <div class="stat-label">Kunden Total</div>
        <div class="stat-change {{ 'negative' if risk_analysis.high_risk_customers|length > 5 else 'positive' }}">
          {{ risk_analysis.high_risk_customers|length }} Risiko-Kunden
        </div>
      </div>
    </div>
    
    <!-- Charts Section -->
    <div class="charts-section">
      <div class="chart-container">
        <h3 class="chart-title">üìà Performance Trends (30 Tage)</h3>
        <div class="chart-canvas">
          <canvas id="timeSeriesChart"></canvas>
        </div>
      </div>
      
      <div class="chart-container">
        <h3 class="chart-title">üïê Performance nach Stunden</h3>
        <div class="chart-canvas">
          <canvas id="hourlyChart"></canvas>
        </div>
      </div>
    </div>
    
    <div class="chart-container" style="margin-bottom: 30px;">
      <h3 class="chart-title">üéØ Kunden-Risiko Verteilung</h3>
      <div class="chart-canvas">
        <canvas id="riskChart"></canvas>
      </div>
    </div>
    
    <!-- Color-Mapping Status -->
    <div class="color-mapping-section" style="margin-bottom: 30px;">
      <h3 class="chart-title">üé® Color-Mapping Status</h3>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        
        <!-- Blockierende Farben -->
        <div class="color-group">
          <h4 style="color: var(--red); margin-bottom: 15px;">üö´ Blockierende Farben ({{ color_status.blocking|length }})</h4>
          <div style="display: grid; gap: 8px;">
            {% for color in color_status.blocking %}
            <div style="background: var(--box-bg); padding: 10px; border-radius: 8px; border-left: 4px solid var(--red);">
              <strong>{{ color.name }}</strong> (ID: {{ color.id }})<br>
              <small style="color: var(--muted);">{{ color.description }}</small>
            </div>
            {% endfor %}
          </div>
        </div>
        
        <!-- Nicht-blockierende Farben -->
        <div class="color-group">
          <h4 style="color: var(--green); margin-bottom: 15px;">‚úÖ Nicht-blockierende Farben ({{ color_status.non_blocking|length }})</h4>
          <div style="display: grid; gap: 8px;">
            {% for color in color_status.non_blocking %}
            <div style="background: var(--box-bg); padding: 10px; border-radius: 8px; border-left: 4px solid var(--green);">
              <strong>{{ color.name }}</strong> (ID: {{ color.id }})<br>
              <small style="color: var(--muted);">{{ color.description }}</small>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    
    <!-- ML Insights Section -->
    <div class="ml-section">
      <h2 class="ml-title">
        ü§ñ Machine Learning Bereitschaft
      </h2>
      
      <div class="readiness-score">
        <div class="score-circle {{ 'ready' if ml_insights.data_readiness.ready_for_ml else 'partial' if ml_insights.data_readiness.score > 50 else 'not-ready' }}">
          {{ "%.0f"|format(ml_insights.data_readiness.score) }}%
        </div>
        <div>
          <h3>Data Readiness Score</h3>
          <p>
            üìä {{ ml_insights.data_readiness.bookings }} Buchungen<br>
            üéØ {{ ml_insights.data_readiness.outcomes }} Outcomes<br>
            üë• {{ ml_insights.data_readiness.customers }} Kunden<br>
            üìÖ {{ ml_insights.data_readiness.days }} Tage mit Daten
          </p>
          {% if ml_insights.data_readiness.ready_for_ml %}
            <p style="color: #10b981;">‚úÖ Bereit f√ºr Machine Learning!</p>
          {% else %}
            <p style="color: #f59e0b;">‚è≥ Mehr Daten ben√∂tigt f√ºr ML</p>
          {% endif %}
        </div>
      </div>
      
      {% if ml_insights.pattern_detection.time_patterns %}
      <div style="margin-top: 20px;">
        <h4>üîç Erkannte Patterns:</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px;">
          <div style="padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
            <strong>Beste Zeit:</strong> {{ ml_insights.pattern_detection.time_patterns.best_hour }}:00 Uhr<br>
            <small style="color: var(--muted);">Niedrigste No-Show Rate</small>
          </div>
          <div style="padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
            <strong>Schlechteste Zeit:</strong> {{ ml_insights.pattern_detection.time_patterns.worst_hour }}:00 Uhr<br>
            <small style="color: var(--muted);">H√∂chste No-Show Rate</small>
          </div>
        </div>
      </div>
      {% endif %}
      
      <h4 style="margin-top: 25px;">üéØ Empfohlene ML-Modelle:</h4>
      <div class="model-recommendations">
        {% for model in ml_insights.recommended_models %}
        <div class="model-card">
          <h5>{{ model.name }}</h5>
          <p><strong>Use Case:</strong> {{ model.use_case }}</p>
          <p><strong>Erwartete Genauigkeit:</strong> {{ model.accuracy_expectation }}</p>
          <p><strong>Aufwand:</strong> {{ model.implementation_effort }}</p>
        </div>
        {% endfor %}
      </div>
    </div>
    
    <!-- Risk Analysis -->
    <div class="analysis-tabs">
      <button class="tab-btn active" onclick="switchTab('risk')">üö® Risiko-Analyse</button>
      <button class="tab-btn" onclick="switchTab('patterns')">üìä Pattern-Analyse</button>
      <button class="tab-btn" onclick="switchTab('predictions')">üîÆ Predictions</button>
    </div>
    
    <div id="risk-tab" class="tab-content active">
      <div class="risk-analysis">
        <div class="risk-card high-risk">
          <h3 class="risk-title">
            ‚ö†Ô∏è Hoch-Risiko Kunden
            <span style="background: rgba(239,68,68,0.2); color: #ef4444; padding: 4px 8px; border-radius: 12px; font-size: 12px;">
              {{ risk_analysis.high_risk_customers|length }}
            </span>
          </h3>
          <div class="customer-list">
            {% for customer in risk_analysis.high_risk_customers[:10] %}
            <div class="customer-item">
              <span>{{ customer.name }}</span>
              <span style="color: #ef4444;">{{ customer.no_shows }} No-Shows</span>
            </div>
            {% endfor %}
          </div>
        </div>
        
        <div class="risk-card low-risk">
          <h3 class="risk-title">
            ‚úÖ Zuverl√§ssige Kunden
            <span style="background: rgba(16,185,129,0.2); color: #10b981; padding: 4px 8px; border-radius: 12px; font-size: 12px;">
              {{ risk_analysis.loyal_customers|length }}
            </span>
          </h3>
          <div class="customer-list">
            {% for customer in risk_analysis.loyal_customers[:10] %}
            <div class="customer-item">
              <span>{{ customer.name }}</span>
              <span style="color: #10b981;">{{ "%.0f"|format(customer.reliability_score) }}%</span>
            </div>
            {% endfor %}
          </div>
        </div>
        
        <div class="risk-card medium-risk">
          <h3 class="risk-title">
            üÜï Neue Kunden
            <span style="background: rgba(234,179,8,0.2); color: #eab308; padding: 4px 8px; border-radius: 12px; font-size: 12px;">
              {{ risk_analysis.new_customers|length }}
            </span>
          </h3>
          <div class="customer-list">
            {% for customer in risk_analysis.new_customers[:10] %}
            <div class="customer-item">
              <span>{{ customer.name }}</span>
              <span style="color: #eab308;">{{ customer.total_appointments }} Termine</span>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    
    <div id="patterns-tab" class="tab-content">
      <div class="glass panel">
        <h3>üìä Detaillierte Pattern-Analyse</h3>
        <p style="color: var(--muted);">
          Erweiterte Pattern-Erkennung wird verf√ºgbar, sobald mehr Daten gesammelt wurden.
          Aktuell werden grundlegende Zeitpatterns analysiert.
        </p>
        
        {% if ml_insights.pattern_detection.time_patterns.hour_rates %}
        <table class="analysis-table">
          <thead>
            <tr>
              <th>Stunde</th>
              <th>No-Show Rate</th>
              <th>Empfehlung</th>
            </tr>
          </thead>
          <tbody>
            {% for hour, rate in ml_insights.pattern_detection.time_patterns.hour_rates.items() %}
            <tr>
              <td>{{ hour }}:00 Uhr</td>
              <td>
                <span style="color: {{ '#10b981' if rate < 20 else '#f59e0b' if rate < 40 else '#ef4444' }};">
                  {{ rate }}%
                </span>
              </td>
              <td>
                {% if rate < 20 %}‚úÖ Optimal
                {% elif rate < 40 %}‚ö†Ô∏è Aufmerksam bleiben
                {% else %}üö® Verst√§rkte Nachfass-Strategie
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% endif %}
      </div>
    </div>
    
    <div id="predictions-tab" class="tab-content">
      <div class="glass panel">
        <h3>üîÆ Prediction Engine</h3>
        {% if ml_insights.prediction_readiness.ready %}
        <p style="color: #10b981;">
          ‚úÖ System bereit f√ºr Predictions! 
          Genauigkeit wird bei {{ ml_insights.prediction_readiness.confidence }} Confidence erwartet.
        </p>
        {% else %}
        <p style="color: #f59e0b;">
          ‚è≥ Prediction Engine wird aktiviert sobald mehr Daten verf√ºgbar sind.<br>
          <strong>Grund:</strong> {{ ml_insights.prediction_readiness.reason }}
        </p>
        {% endif %}
        
        <h4>üéØ Geplante Features:</h4>
        <ul style="color: var(--muted);">
          <li>üîç No-Show Wahrscheinlichkeit pro Kunde</li>
          <li>üìÖ Optimale Terminzeiten Vorschl√§ge</li>
          <li>üìä Nachfrage-Prognose</li>
          <li>üéØ Personalisierte Nachfass-Strategien</li>
          <li>üìà Kapazit√§ts-Optimierung</li>
        </ul>
      </div>
    </div>
    
    <!-- Export Section -->
    <div class="export-section" id="export">
      <h3>üì• Daten Export f√ºr ML-Analyse</h3>
      <p style="color: var(--muted); margin-bottom: 20px;">
        Exportiere alle gesammelten Daten f√ºr externe ML-Tools oder tiefere Analysen.
      </p>
      <a href="{{ url_for('export_analytics') }}" class="export-btn">
        <i class="ti ti-download"></i>
        Vollst√§ndigen Datensatz exportieren (JSON)
      </a>
    </div>
    
    <!-- Admin Tools Section -->
    <div class="export-section" id="admin-tools">
      <h3>üîß Admin Tools</h3>
      <p style="color: var(--muted); margin-bottom: 20px;">
        Spezielle Admin-Funktionen f√ºr Systemwartung und Datenkorrektur.
      </p>
      <a href="{{ url_for('admin_fix_points') }}" class="export-btn" style="background: #f59e0b;">
        <i class="ti ti-trophy"></i>
        Punkte f√ºr getrackte Buchungen vergeben
      </a>
      <a href="{{ url_for('export_csv') }}" class="export-btn" style="background: #10b981;">
        <i class="ti ti-file-spreadsheet"></i>
        CSV Export (ZIP)
      </a>
      <a href="{{ url_for('admin_export_pdf') }}" class="export-btn" style="background: #ef4444;">
        <i class="ti ti-file-text"></i>
        PDF Report
      </a>
    </div>
    
  </div>
  
  <script>
    // Chart.js Konfiguration
    Chart.defaults.color = getComputedStyle(document.documentElement).getPropertyValue('--text-color');
    Chart.defaults.borderColor = getComputedStyle(document.documentElement).getPropertyValue('--box-border');
    
    // Time Series Chart
    const timeSeriesCtx = document.getElementById('timeSeriesChart').getContext('2d');
    new Chart(timeSeriesCtx, {
      type: 'line',
      data: {
        labels: {{ charts.time_series.dates | tojson }},
        datasets: [{
          label: 'No-Show Rate (%)',
          data: {{ charts.time_series.no_show_rates | tojson }},
          borderColor: '#ef4444',
          backgroundColor: 'rgba(239, 68, 68, 0.1)',
          tension: 0.4,
          fill: true
        }, {
          label: 'Erfolgsquote (%)',
          data: {{ charts.time_series.completion_rates | tojson }},
          borderColor: '#10b981',
          backgroundColor: 'rgba(16, 185, 129, 0.1)',
          tension: 0.4,
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'top',
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            max: 100,
            ticks: {
              callback: function(value) {
                return value + '%';
              }
            }
          }
        }
      }
    });
    
    // Hourly Performance Chart
    const hourlyCtx = document.getElementById('hourlyChart').getContext('2d');
    new Chart(hourlyCtx, {
      type: 'bar',
      data: {
        labels: {{ charts.hourly_performance.hours | tojson }},
        datasets: [{
          label: 'No-Show Rate (%)',
          data: {{ charts.hourly_performance.no_show_rates | tojson }},
          backgroundColor: function(context) {
            const value = context.parsed.y;
            if (value < 20) return 'rgba(16, 185, 129, 0.8)';
            if (value < 40) return 'rgba(245, 158, 11, 0.8)';
            return 'rgba(239, 68, 68, 0.8)';
          },
          borderColor: function(context) {
            const value = context.parsed.y;
            if (value < 20) return '#10b981';
            if (value < 40) return '#f59e0b';
            return '#ef4444';
          },
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            max: 100,
            ticks: {
              callback: function(value) {
                return value + '%';
              }
            }
          }
        }
      }
    });
    
    // Risk Distribution Pie Chart
    const riskCtx = document.getElementById('riskChart').getContext('2d');
    new Chart(riskCtx, {
      type: 'doughnut',
      data: {
        labels: ['Niedrig Risiko', 'Mittel Risiko', 'Hoch Risiko'],
        datasets: [{
          data: [
            {{ charts.risk_distribution.low }},
            {{ charts.risk_distribution.medium }},
            {{ charts.risk_distribution.high }}
          ],
          backgroundColor: [
            'rgba(16, 185, 129, 0.8)',
            'rgba(245, 158, 11, 0.8)',
            'rgba(239, 68, 68, 0.8)'
          ],
          borderColor: [
            '#10b981',
            '#f59e0b',
            '#ef4444'
          ],
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
          }
        }
      }
    });
    
    // Tab Switching
    function switchTab(tabName) {
      // Alle Tabs deaktivieren
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      // Aktiven Tab aktivieren
      document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
      document.getElementById(`${tabName}-tab`).classList.add('active');
    }
    
    // Refresh Dashboard
    function refreshDashboard() {
      location.reload();
    }
    
    // Auto-refresh alle 5 Minuten
    setInterval(() => {
      console.log('Dashboard auto-refreshing...');
      location.reload();
    }, 5 * 60 * 1000);
  </script>
</body>
</html>