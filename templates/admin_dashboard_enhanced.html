<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>ðŸ“Š Admin Dashboard - Erweiterte Analytics mit Historischen Daten</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='admin_style.css') }}">
  <link href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@2.47.0/tabler-icons.min.css" rel="stylesheet">
  
  <!-- Chart.js fÃ¼r Grafiken -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  
  <style>
    .admin-dashboard {
      max-width: 1600px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .dashboard-header {
      background: linear-gradient(135deg, rgba(90,177,255,0.15), rgba(16,185,129,0.15), rgba(139,92,246,0.1));
      border-radius: var(--radius-lg);
      padding: 40px;
      margin-bottom: 30px;
      text-align: center;
      border: 1px solid var(--accent);
      box-shadow: 0 10px 30px rgba(90,177,255,0.1);
    }
    
    .dashboard-title {
      font-size: 32px;
      font-weight: 700;
      color: var(--accent);
      margin: 0 0 10px;
    }
    
    .dashboard-subtitle {
      color: var(--muted);
      margin: 0 0 20px;
    }
    
    .historical-badge {
      background: linear-gradient(135deg, #8b5cf6, #a855f7);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      display: inline-block;
      font-weight: 600;
      margin-left: 10px;
    }
    
    /* Historische Daten Sektion */
    .historical-section {
      background: linear-gradient(135deg, rgba(139,92,246,0.15), rgba(236,72,153,0.15));
      border: 1px solid rgba(139,92,246,0.3);
      border-radius: var(--radius-lg);
      padding: 30px;
      margin-bottom: 30px;
    }
    
    .historical-title {
      font-size: 24px;
      font-weight: 700;
      color: #8b5cf6;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .historical-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .historical-stat-card {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: var(--radius-md);
      padding: 20px;
      text-align: center;
    }
    
    .historical-stat-value {
      font-size: 28px;
      font-weight: 700;
      color: #8b5cf6;
      margin-bottom: 5px;
    }
    
    .historical-stat-label {
      color: var(--muted);
      font-size: 14px;
    }
    
    /* Vergleich Sektion */
    .comparison-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .comparison-card {
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: var(--radius-lg);
      padding: 25px;
    }
    
    .comparison-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--accent);
    }
    
    .comparison-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .comparison-item:last-child {
      border-bottom: none;
    }
    
    .comparison-label {
      color: var(--muted);
    }
    
    .comparison-value {
      font-weight: 600;
    }
    
    .comparison-trend {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .trend-improving {
      background: rgba(16,185,129,0.2);
      color: #10b981;
    }
    
    .trend-declining {
      background: rgba(239,68,68,0.2);
      color: #ef4444;
    }
    
    /* Empfehlungen */
    .recommendations-section {
      background: linear-gradient(135deg, rgba(16,185,129,0.15), rgba(34,197,94,0.15));
      border: 1px solid rgba(16,185,129,0.3);
      border-radius: var(--radius-lg);
      padding: 25px;
      margin-bottom: 30px;
    }
    
    .recommendations-title {
      font-size: 20px;
      font-weight: 600;
      color: #10b981;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .recommendation-item {
      background: rgba(255,255,255,0.1);
      border-radius: var(--radius-md);
      padding: 15px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .recommendation-item:last-child {
      margin-bottom: 0;
    }
    
    /* Beste Zeiten */
    .best-times-section {
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: var(--radius-lg);
      padding: 25px;
      margin-bottom: 30px;
    }
    
    .best-times-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 20px;
    }
    
    .time-slots {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }
    
    .time-slot {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: var(--radius-md);
      padding: 15px;
      text-align: center;
    }
    
    .time-slot.best {
      background: rgba(16,185,129,0.2);
      border-color: rgba(16,185,129,0.4);
    }
    
    .time-slot-time {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .time-slot-rate {
      font-size: 14px;
      color: var(--muted);
    }
    
    /* Wochentag Analyse */
    .weekday-analysis {
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: var(--radius-lg);
      padding: 25px;
      margin-bottom: 30px;
    }
    
    .weekday-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 20px;
    }
    
    .weekday-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    
    .weekday-card {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: var(--radius-md);
      padding: 15px;
    }
    
    .weekday-name {
      font-weight: 600;
      margin-bottom: 10px;
      color: var(--accent);
    }
    
    .weekday-stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }
    
    .weekday-label {
      color: var(--muted);
      font-size: 14px;
    }
    
    .weekday-value {
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="admin-dashboard">
    <!-- Include Admin Navigation -->
    {% include 'admin_nav.html' %}

    <!-- Header -->
    <div class="dashboard-header">
      <h1 class="dashboard-title">
        ðŸ“Š Admin Dashboard
        <span class="historical-badge">ðŸ“ˆ Mit Historischen Daten</span>
      </h1>
      <p class="dashboard-subtitle">
        Erweiterte Analytics mit Daten seit {{ dashboard.historical.date_range.start if dashboard.historical else 'N/A' }}
      </p>
      <div class="running-time">
        <i class="ti ti-clock"></i>
        App lÃ¤uft seit {{ days_running }} Tagen
      </div>
    </div>

    <!-- Aktuelle Tracking Daten Ãœbersicht -->
    {% if dashboard.current_totals %}
    <div class="historical-section">
      <h2 class="historical-title">
        <i class="ti ti-database"></i>
        Aktuelle Tracking Daten
      </h2>

      <div class="historical-stats">
        <div class="historical-stat-card">
          <div class="historical-stat-value">{{ dashboard.current_totals.days_tracked }}</div>
          <div class="historical-stat-label">Tage Daten</div>
        </div>
        <div class="historical-stat-card">
          <div class="historical-stat-value">{{ dashboard.current_totals.total_slots }}</div>
          <div class="historical-stat-label">Termine Gelegt</div>
        </div>
        <div class="historical-stat-card">
          <div class="historical-stat-value">{{ dashboard.current_totals.total_appeared }}</div>
          <div class="historical-stat-label">Erschienen</div>
        </div>
        <div class="historical-stat-card">
          <div class="historical-stat-value">{{ dashboard.current_totals.total_not_appeared }}</div>
          <div class="historical-stat-label">Nicht Erschienen</div>
        </div>
        <div class="historical-stat-card">
          <div class="historical-stat-value">{{ "%.1f"|format(dashboard.current_totals.appearance_rate) }}%</div>
          <div class="historical-stat-label">Auftauchquote</div>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Vergleich Aktuell vs. Historisch (Disabled - Using current tracking only) -->
    {% if false %}
    <div class="comparison-section">
      <div class="comparison-card">
        <h3 class="comparison-title">
          <i class="ti ti-trending-up"></i>
          Auftauchquote Vergleich (Disabled)
        </h3>
        <p>Historical comparison disabled - using current tracking data only.</p>
      </div>


    </div>
    {% endif %}

    <!-- Beste Zeiten basierend auf historischen Daten (Disabled - Using current tracking only) -->
    {% if false %}
    <div class="best-times-section">
      <h3 class="best-times-title">
        <i class="ti ti-clock"></i>
        Beste Zeiten (Historische Daten)
      </h3>
      <div class="time-slots">
        {% for time, stats in dashboard.historical.by_time.items() %}
        <div class="time-slot {{ 'best' if loop.index <= 3 else '' }}">
          <div class="time-slot-time">{{ time }}</div>
          <div class="time-slot-rate">
            Auftauchquote: {{ "%.1f"|format(stats.appearance_rate * 100) }}%
          </div>
          <div class="time-slot-rate">
            Auftauch: {{ "%.1f"|format(stats.appearance_rate * 100) }}%
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Wochentag Analyse (Disabled - Using current tracking only) -->
    {% if false %}
    <div class="weekday-analysis">
      <h3 class="weekday-title">
        <i class="ti ti-calendar"></i>
        Wochentag Analyse (Historische Daten)
      </h3>
      <div class="weekday-grid">
        {% for weekday, stats in dashboard.historical.by_weekday.items() %}
        <div class="weekday-card">
          <div class="weekday-name">{{ weekday }}</div>
          <div class="weekday-stats">
            <span class="weekday-label">Termine:</span>
            <span class="weekday-value">{{ stats.total_slots }}</span>
          </div>
          <div class="weekday-stats">
            <span class="weekday-label">Erschienen:</span>
            <span class="weekday-value">{{ stats.total_appeared }}</span>
          </div>
          <div class="weekday-stats">
            <span class="weekday-label">Auftauchquote:</span>
            <span class="weekday-value">{{ "%.1f"|format(stats.appearance_rate * 100) }}%</span>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Empfehlungen (Disabled - Using current tracking only) -->
    {% if false %}
    <div class="recommendations-section">
      <h3 class="recommendations-title">
        <i class="ti ti-lightbulb"></i>
        Empfehlungen (Disabled)
      </h3>
      <p>Historical recommendations disabled - using current tracking data only.</p>
    </div>
    {% endif %}

    <!-- Aktuelle Dashboard-Daten -->
    {% if dashboard.last_7_days or dashboard.last_30_days %}
    <div class="stats-overview">
      <div class="stat-card">
        <div class="stat-value">{{ dashboard.last_7_days.total_bookings if dashboard.last_7_days else 0 }}</div>
        <div class="stat-label">Buchungen (7 Tage)</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">{{ "%.1f"|format(dashboard.last_7_days.appearance_rate) if dashboard.last_7_days else 0 }}%</div>
        <div class="stat-label">Auftauchquote (7 Tage)</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">{{ "%.1f"|format(dashboard.last_30_days.success_rate) if dashboard.last_30_days else 0 }}%</div>
        <div class="stat-label">Erfolgsquote (30 Tage)</div>
      </div>
    </div>
    {% endif %}

    <!-- Navigation -->
    <div class="quick-actions">
      <a href="{{ url_for('index') }}" class="action-btn secondary">
        <i class="ti ti-home"></i>
        ZurÃ¼ck zur Hauptseite
      </a>
      <a href="{{ url_for('admin_dashboard') }}" class="action-btn primary">
        <i class="ti ti-refresh"></i>
        Dashboard aktualisieren
      </a>
      <a href="{{ url_for('admin_debug_points') }}" class="action-btn warning">
        <i class="ti ti-bug"></i>
        Punkte Debug
      </a>
      <a href="{{ url_for('admin_fix_points') }}" class="action-btn success">
        <i class="ti ti-trophy"></i>
        Punkte Fix
      </a>
    </div>
  </div>

  <script>
    // Chart.js Konfiguration fÃ¼r bessere Performance
    Chart.defaults.font.family = 'Inter, system-ui, sans-serif';
    Chart.defaults.color = '#9ca3af';
    
    // Responsive Design
    function updateLayout() {
      const isMobile = window.innerWidth < 768;
      const dashboard = document.querySelector('.admin-dashboard');
      
      if (isMobile) {
        dashboard.style.padding = '10px';
      } else {
        dashboard.style.padding = '20px';
      }
    }
    
    window.addEventListener('resize', updateLayout);
    updateLayout();
  </script>
</body>
</html>
