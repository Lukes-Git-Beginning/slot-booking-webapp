{% extends "base.html" %}

{% block title %}{% block t2_title %}T2-Closer System{% endblock %}{% endblock %}

{% block tailwind_config_colors %}'t2-purple': '#d4af6a',{% endblock %}

{% block body_attrs %}{% endblock %}

{% block area_css %}
    <style nonce="{{ csp_nonce }}">
        /* T2-Specific Styles */
        .closer-card {
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .closer-card::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(212, 175, 106, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .closer-card:hover::after {
            opacity: 1;
        }

        .closer-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 60px rgba(212, 175, 106, 0.3);
        }

        /* Ticket Badge Animation */
        .ticket-badge {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }
    </style>
{% endblock %}

{% block navbar %}
    <!-- Modern Navbar -->
    <nav class="glass sticky top-0 z-50 backdrop-blur-xl"
         x-data="{ userMenuOpen: false }"
         data-aos="fade-down">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">

                <!-- Brand & Back Button -->
                <div class="flex items-center gap-4">
                    <a href="{{ url_for('hub.dashboard') }}"
                       class="flex items-center gap-3 glass px-4 py-2 rounded-xl hover:bg-white/10 transition-all group">
                        <i data-lucide="arrow-left" class="w-5 h-5 group-hover:-translate-x-1 transition-transform"></i>
                        <span class="hidden md:inline">Zur√ºck zum Hub</span>
                    </a>

                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-secondary flex items-center justify-center">
                            <i data-lucide="target" class="w-5 h-5 text-white"></i>
                        </div>
                        <div class="hidden md:block">
                            <h1 class="text-lg font-bold">T2-Closer System</h1>
                            <p class="text-xs text-gray-400">Premium 2-Stunden-Beratungen</p>
                        </div>
                    </div>
                </div>

                <!-- User Menu -->
                {% if user %}
                <div class="flex items-center gap-4">
                    <!-- Theme Toggle -->
                    <button @click="toggleTheme()"
                            class="btn btn-circle btn-ghost hover:bg-white/10">
                        <i data-lucide="sun" class="w-5 h-5" x-show="$store.theme.current === 'dark'"></i>
                        <i data-lucide="moon" class="w-5 h-5" x-show="$store.theme.current === 'light'"></i>
                    </button>

                    <div class="relative" @click.away="userMenuOpen = false">
                        <button @click="userMenuOpen = !userMenuOpen"
                                class="flex items-center gap-3 glass px-4 py-2 rounded-xl hover:bg-white/10 transition-all">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center font-bold">
                                {{ user[0]|upper }}
                            </div>
                            <div class="text-left hidden md:block">
                                <p class="font-semibold">{{ user }}</p>
                                <p class="text-xs text-gray-400">
                                    {% if is_admin %}Admin{% else %}Benutzer{% endif %}
                                </p>
                            </div>
                            <i data-lucide="chevron-down" class="w-4 h-4"></i>
                        </button>

                        <!-- User Dropdown Menu -->
                        <div x-show="userMenuOpen"
                             x-transition
                             class="absolute right-0 mt-2 w-56 glass rounded-2xl p-2 shadow-2xl">
                            <a href="{{ url_for('t2.dashboard') }}" class="flex items-center gap-3 px-4 py-2 hover:bg-white/10 rounded-lg transition-colors">
                                <i data-lucide="home" class="w-4 h-4"></i>
                                <span>T2 Dashboard</span>
                            </a>
                            <a href="{{ url_for('t2.my_analytics') }}" class="flex items-center gap-3 px-4 py-2 hover:bg-white/10 rounded-lg transition-colors">
                                <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
                                <span>Meine Analytics</span>
                            </a>
                            {% if is_admin %}
                            <div class="divider my-1"></div>
                            <a href="{{ url_for('t2.admin_bucket_config') }}" class="flex items-center gap-3 px-4 py-2 hover:bg-white/10 rounded-lg transition-colors">
                                <i data-lucide="settings" class="w-4 h-4"></i>
                                <span>Bucket Config</span>
                            </a>
                            <a href="{{ url_for('admin.admin_dashboard') }}" class="flex items-center gap-3 px-4 py-2 hover:bg-white/10 rounded-lg transition-colors">
                                <i data-lucide="shield" class="w-4 h-4"></i>
                                <span>Administration</span>
                            </a>
                            {% endif %}
                            <div class="divider my-1"></div>
                            <a href="{{ url_for('auth.logout') }}"
                               class="flex items-center gap-3 px-4 py-2 hover:bg-error/20 text-error rounded-lg transition-colors">
                                <i data-lucide="log-out" class="w-4 h-4"></i>
                                <span>Abmelden</span>
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </nav>
{% endblock %}

{% block footer %}
    <!-- Footer -->
    <footer class="glass mt-16 backdrop-blur-xl" data-aos="fade-up">
        <div class="container mx-auto px-4 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-primary to-secondary flex items-center justify-center">
                        <i data-lucide="zap" class="w-5 h-5 text-white"></i>
                    </div>
                    <div class="text-sm">
                        <p class="font-semibold">T2-Closer System</p>
                        <p class="text-gray-400">Premium 2-Stunden-Beratungen</p>
                    </div>
                </div>
                <div class="flex items-center gap-6 text-sm text-gray-400">
                    <a href="/health" class="flex items-center gap-2 hover:text-primary transition-colors">
                        <i data-lucide="activity" class="w-4 h-4"></i>
                        <span>Status</span>
                    </a>
                    <span>Version 3.3.15</span>
                </div>
            </div>
        </div>
    </footer>
{% endblock %}

{% block particles_config %}
    <!-- T2 Particles.js Configuration (80 particles, with interactivity) -->
    <script nonce="{{ csp_nonce }}">
        particlesJS('particles-js', {
            particles: {
                number: { value: 80, density: { enable: true, value_area: 800 } },
                color: { value: '#d4af6a' },
                shape: { type: 'circle' },
                opacity: {
                    value: 0.3,
                    random: true,
                    anim: { enable: true, speed: 1, opacity_min: 0.1, sync: false }
                },
                size: {
                    value: 3,
                    random: true,
                    anim: { enable: true, speed: 2, size_min: 0.1, sync: false }
                },
                line_linked: {
                    enable: true,
                    distance: 150,
                    color: '#d4af6a',
                    opacity: 0.2,
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 1,
                    direction: 'none',
                    random: false,
                    straight: false,
                    out_mode: 'out',
                    bounce: false
                }
            },
            interactivity: {
                detect_on: 'canvas',
                events: {
                    onhover: { enable: true, mode: 'grab' },
                    onclick: { enable: true, mode: 'push' },
                    resize: true
                },
                modes: {
                    grab: { distance: 140, line_linked: { opacity: 0.5 } },
                    push: { particles_nb: 4 }
                }
            },
            retina_detect: true
        });
    </script>
{% endblock %}

{% block theme_js %}
    <!-- Alpine.js Theme Store -->
    <script nonce="{{ csp_nonce }}">
        document.addEventListener('alpine:init', () => {
            Alpine.store('theme', {
                current: localStorage.getItem('theme') || 'dark',
                init() {
                    document.documentElement.setAttribute('data-theme', this.current);
                },
                toggle() {
                    this.current = this.current === 'dark' ? 'light' : 'dark';
                    localStorage.setItem('theme', this.current);
                    document.documentElement.setAttribute('data-theme', this.current);
                    setTimeout(() => lucide.createIcons(), 50);
                }
            });
        });

        // Set initial theme
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);

        // Toggle theme function
        function toggleTheme() {
            const store = Alpine.store('theme');
            if (store) store.toggle();
        }
    </script>
{% endblock %}
